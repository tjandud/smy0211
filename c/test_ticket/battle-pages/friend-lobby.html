<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¹œêµ¬ ëŒ€ê²° - TicketPro</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Noto+Sans+KR:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        :root {
            --bg: #0a0a0f;
            --card: rgba(255, 255, 255, 0.03);
            --card-border: rgba(255, 255, 255, 0.06);
            --text-primary: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.6);
            --accent-purple: #a78bfa;
            --accent-blue: #60a5fa;
            --accent-pink: #f472b6;
            --accent-green: #4ade80;
            --accent-yellow: #facc15;
            --accent-red: #f87171;
            --accent-emerald: #34d399;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', 'Inter', sans-serif;
            background: var(--bg);
            min-height: 100vh;
            color: var(--text-primary);
            overflow-x: hidden;
        }

        /* ë°°ê²½ íš¨ê³¼ */
        .bg-effects {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
            overflow: hidden;
        }

        .gradient-orb {
            position: absolute;
            border-radius: 50%;
            filter: blur(80px);
            opacity: 0.5;
            animation: float 20s ease-in-out infinite;
        }

        .orb-1 {
            width: 400px;
            height: 400px;
            background: linear-gradient(135deg, rgba(52, 211, 153, 0.3), rgba(16, 185, 129, 0.1));
            top: -100px;
            left: -100px;
        }

        .orb-2 {
            width: 300px;
            height: 300px;
            background: linear-gradient(135deg, rgba(96, 165, 250, 0.2), rgba(59, 130, 246, 0.1));
            bottom: -50px;
            right: -50px;
            animation-delay: -10s;
        }

        .orb-3 {
            width: 250px;
            height: 250px;
            background: linear-gradient(135deg, rgba(167, 139, 250, 0.2), rgba(139, 92, 246, 0.1));
            top: 40%;
            right: 10%;
            animation-delay: -5s;
        }

        @keyframes float {
            0%, 100% { transform: translate(0, 0) scale(1); }
            25% { transform: translate(30px, -30px) scale(1.05); }
            50% { transform: translate(-20px, 20px) scale(0.95); }
            75% { transform: translate(-30px, -20px) scale(1.02); }
        }

        /* ê³µí†µ ë„¤ë¹„ë°” */
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 32px;
            background: rgba(255, 255, 255, 0.02);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--card-border);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .nav-logo {
            position: relative;
            display: flex;
            align-items: center;
            gap: 10px;
            text-decoration: none;
            padding: 10px 24px;
            background: linear-gradient(135deg, #8b5cf6 0%, #a855f7 50%, #ec4899 100%);
            border: 2px solid #a78bfa;
            border-radius: 12px;
            box-shadow: 0 0 0 rgba(139, 92, 246, 0.5);
            transition: all 0.3s ease-in-out;
            cursor: pointer;
            overflow: visible;
        }

        .nav-logo:hover {
            background: transparent;
            box-shadow: 0 0 25px rgba(139, 92, 246, 0.6);
        }

        .nav-logo-text {
            font-size: 16px;
            font-weight: 700;
            color: #ffffff;
            z-index: 2;
            transition: all 0.3s ease;
        }

        .nav-logo:hover .nav-logo-text {
            background: linear-gradient(135deg, #8b5cf6, #ec4899);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* ë³„ ì• ë‹ˆë©”ì´ì…˜ */
        .nav-logo .star {
            position: absolute;
            width: 20px;
            height: auto;
            filter: drop-shadow(0 0 0 #e0d4ff);
            z-index: -5;
            transition: all 1s cubic-bezier(0.05, 0.83, 0.43, 0.96);
        }

        .nav-logo .star svg { width: 100%; height: 100%; }
        .nav-logo .star-1 { top: 50%; left: 20%; width: 18px; transform: translateY(-50%); }
        .nav-logo .star-2 { top: 50%; left: 50%; width: 12px; transform: translate(-50%, -50%); }
        .nav-logo .star-3 { top: 50%; left: 35%; width: 6px; transform: translateY(-50%); }
        .nav-logo .star-4 { top: 50%; left: 65%; width: 8px; transform: translateY(-50%); }
        .nav-logo .star-5 { top: 50%; left: 75%; width: 14px; transform: translateY(-50%); }
        .nav-logo .star-6 { top: 50%; left: 85%; width: 5px; transform: translateY(-50%); }

        .nav-logo:hover .star-1 { top: -60%; left: -15%; width: 22px; filter: drop-shadow(0 0 10px #c4b5fd); z-index: 2; transform: translateY(0); }
        .nav-logo:hover .star-2 { top: -30%; left: 5%; width: 14px; filter: drop-shadow(0 0 10px #a78bfa); z-index: 2; transform: translate(0, 0); }
        .nav-logo:hover .star-3 { top: 70%; left: 15%; width: 6px; filter: drop-shadow(0 0 8px #ec4899); z-index: 2; transform: translateY(0); }
        .nav-logo:hover .star-4 { top: 20%; left: 90%; width: 10px; filter: drop-shadow(0 0 10px #c4b5fd); z-index: 2; transform: translateY(0); }
        .nav-logo:hover .star-5 { top: -40%; left: 105%; width: 16px; filter: drop-shadow(0 0 12px #a78bfa); z-index: 2; transform: translateY(0); }
        .nav-logo:hover .star-6 { top: 80%; left: 95%; width: 6px; filter: drop-shadow(0 0 8px #ec4899); z-index: 2; transform: translateY(0); }

        .star-fill { fill: #e0d4ff; }

        .nav-actions {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .nav-btn {
            padding: 8px 16px;
            border-radius: 8px;
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .nav-btn.secondary {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--card-border);
            color: var(--text-secondary);
        }

        .nav-btn.secondary:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
        }

        .nav-btn.battle {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(249, 115, 22, 0.2));
            border: 1px solid rgba(239, 68, 68, 0.4);
            color: var(--accent-red);
        }

        .nav-btn.battle:hover {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.3), rgba(249, 115, 22, 0.3));
        }

        /* ì»¨í…Œì´ë„ˆ */
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 40px 20px;
            position: relative;
            z-index: 1;
        }

        /* í˜ì´ì§€ íƒ€ì´í‹€ */
        .page-header {
            text-align: center;
            margin-bottom: 50px;
        }

        .page-header h1 {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-emerald), var(--accent-blue));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 12px;
        }

        .page-header p {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        /* ì˜µì…˜ ì¹´ë“œ */
        .option-cards {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 24px;
            margin-bottom: 40px;
        }

        .option-card {
            background: var(--card);
            border: 2px solid var(--card-border);
            border-radius: 24px;
            padding: 45px 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .option-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
        }

        .option-card.create {
            border-color: rgba(52, 211, 153, 0.3);
        }

        .option-card.create:hover {
            border-color: var(--accent-emerald);
            box-shadow: 0 25px 50px rgba(52, 211, 153, 0.2);
        }

        .option-card.join {
            border-color: rgba(167, 139, 250, 0.3);
        }

        .option-card.join:hover {
            border-color: var(--accent-purple);
            box-shadow: 0 25px 50px rgba(167, 139, 250, 0.2);
        }

        .option-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            display: block;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.3));
        }

        .option-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 12px;
            color: var(--text-primary);
        }

        .option-desc {
            color: var(--text-secondary);
            font-size: 0.95rem;
            line-height: 1.6;
        }

        /* í¼ ì„¹ì…˜ */
        .form-section {
            display: none;
            background: var(--card);
            border-radius: 24px;
            padding: 35px;
            border: 1px solid var(--card-border);
            backdrop-filter: blur(10px);
        }

        .form-section.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-title {
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: 28px;
            display: flex;
            align-items: center;
            gap: 12px;
            color: var(--text-primary);
        }

        .form-group {
            margin-bottom: 24px;
        }

        .form-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 500;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 14px 18px;
            border-radius: 12px;
            border: 1px solid var(--card-border);
            background: rgba(255, 255, 255, 0.03);
            color: var(--text-primary);
            font-size: 1rem;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .form-group input:focus,
        .form-group select:focus {
            border-color: var(--accent-emerald);
            outline: none;
            background: rgba(52, 211, 153, 0.05);
        }

        .form-group select option {
            background: #1a1a2e;
            color: var(--text-primary);
        }

        .room-code-input {
            text-transform: uppercase;
            text-align: center;
            font-size: 1.8rem !important;
            font-family: 'Courier New', monospace;
            letter-spacing: 10px;
            padding: 18px !important;
        }

        .form-buttons {
            display: flex;
            gap: 16px;
            margin-top: 30px;
        }

        .btn {
            flex: 1;
            padding: 16px 28px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent-emerald) 0%, #22c55e 100%);
            color: white;
            box-shadow: 0 8px 24px rgba(52, 211, 153, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 32px rgba(52, 211, 153, 0.4);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--card-border);
            color: var(--text-secondary);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
        }

        /* ëŒ€ê¸°ì‹¤ */
        .waiting-room {
            display: none;
        }

        .waiting-room.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        .room-info {
            background: linear-gradient(135deg, rgba(52, 211, 153, 0.1) 0%, rgba(59, 130, 246, 0.1) 100%);
            border: 1px solid rgba(52, 211, 153, 0.3);
            border-radius: 24px;
            padding: 35px;
            text-align: center;
            margin-bottom: 35px;
            backdrop-filter: blur(10px);
        }

        .room-info h2 {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: var(--text-primary);
        }

        .room-code-display {
            margin-top: 15px;
        }

        .room-code-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 10px;
        }

        .room-code-value {
            font-size: 3rem;
            font-weight: 800;
            font-family: 'Courier New', monospace;
            letter-spacing: 10px;
            background: linear-gradient(135deg, var(--accent-emerald), var(--accent-blue));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: none;
            filter: drop-shadow(0 4px 8px rgba(52, 211, 153, 0.3));
        }

        .copy-btn {
            margin-top: 20px;
            padding: 12px 28px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--card-border);
            border-radius: 10px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: inherit;
            font-size: 0.95rem;
        }

        .copy-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
        }

        /* í”Œë ˆì´ì–´ ìŠ¬ë¡¯ */
        .players-section {
            margin-bottom: 35px;
        }

        .players-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--text-secondary);
        }

        .player-slots {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        .player-slot {
            background: var(--card);
            border: 2px dashed rgba(255, 255, 255, 0.15);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            min-height: 200px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .player-slot.occupied {
            border-style: solid;
            border-color: rgba(96, 165, 250, 0.4);
            background: rgba(96, 165, 250, 0.05);
        }

        .player-slot.ready {
            border-color: var(--accent-green);
            background: rgba(74, 222, 128, 0.1);
        }

        .player-slot.host {
            border-color: rgba(250, 204, 21, 0.5);
        }

        .player-avatar {
            font-size: 3.5rem;
            margin-bottom: 16px;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.3));
        }

        .player-name {
            font-weight: 600;
            font-size: 1.2rem;
            margin-bottom: 10px;
            color: var(--text-primary);
        }

        .player-status {
            font-size: 0.9rem;
            padding: 6px 16px;
            border-radius: 20px;
            font-weight: 500;
        }

        .player-status.ready {
            background: rgba(74, 222, 128, 0.15);
            color: var(--accent-green);
            border: 1px solid rgba(74, 222, 128, 0.3);
        }

        .player-status.waiting {
            background: rgba(250, 204, 21, 0.15);
            color: var(--accent-yellow);
            border: 1px solid rgba(250, 204, 21, 0.3);
        }

        .player-status.host {
            background: rgba(250, 204, 21, 0.15);
            color: var(--accent-yellow);
            border: 1px solid rgba(250, 204, 21, 0.3);
        }

        .empty-slot-text {
            color: var(--text-secondary);
        }

        /* ë²„íŠ¼ ì˜ì—­ */
        .waiting-actions {
            display: flex;
            gap: 16px;
            justify-content: center;
            margin-bottom: 35px;
            flex-wrap: wrap;
        }

        .ready-btn {
            padding: 16px 45px;
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            border: none;
            border-radius: 14px;
            color: white;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 24px rgba(34, 197, 94, 0.3);
            font-family: inherit;
        }

        .ready-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 32px rgba(34, 197, 94, 0.4);
        }

        .ready-btn.not-ready {
            background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
            box-shadow: 0 8px 24px rgba(107, 114, 128, 0.3);
        }

        .start-btn {
            padding: 16px 45px;
            background: linear-gradient(135deg, var(--accent-purple) 0%, #6366f1 100%);
            border: none;
            border-radius: 14px;
            color: white;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 24px rgba(167, 139, 250, 0.3);
            font-family: inherit;
        }

        .start-btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 12px 32px rgba(167, 139, 250, 0.4);
        }

        .start-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
            transform: none;
        }

        .leave-btn {
            padding: 16px 35px;
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.4);
            border-radius: 14px;
            color: var(--accent-red);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .leave-btn:hover {
            background: rgba(239, 68, 68, 0.2);
        }

        /* ì±„íŒ… */
        .chat-section {
            background: var(--card);
            border: 1px solid var(--card-border);
            border-radius: 20px;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        .chat-header {
            padding: 16px 20px;
            background: rgba(255, 255, 255, 0.03);
            font-weight: 600;
            border-bottom: 1px solid var(--card-border);
            color: var(--text-primary);
        }

        .chat-messages {
            height: 220px;
            padding: 16px;
            overflow-y: auto;
        }

        .chat-message {
            margin-bottom: 12px;
            padding: 10px 14px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
        }

        .chat-message .sender {
            font-weight: 600;
            color: var(--accent-blue);
            margin-right: 10px;
        }

        .chat-message .text {
            color: var(--text-secondary);
        }

        .chat-message.system {
            background: rgba(250, 204, 21, 0.1);
            color: var(--accent-yellow);
            font-style: italic;
            border: 1px solid rgba(250, 204, 21, 0.2);
        }

        .chat-input-area {
            display: flex;
            border-top: 1px solid var(--card-border);
        }

        .chat-input-area input {
            flex: 1;
            padding: 16px;
            background: transparent;
            border: none;
            color: var(--text-primary);
            font-size: 1rem;
            font-family: inherit;
        }

        .chat-input-area input:focus {
            outline: none;
        }

        .chat-input-area input::placeholder {
            color: var(--text-secondary);
        }

        .chat-input-area button {
            padding: 16px 28px;
            background: var(--accent-blue);
            border: none;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .chat-input-area button:hover {
            background: #3b82f6;
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            .navbar {
                padding: 12px 16px;
            }

            .nav-title {
                display: none;
            }

            .container {
                padding: 24px 16px;
            }

            .page-header h1 {
                font-size: 1.8rem;
            }

            .option-cards {
                grid-template-columns: 1fr;
                gap: 16px;
            }

            .option-card {
                padding: 35px 24px;
            }

            .player-slots {
                grid-template-columns: 1fr;
            }

            .room-code-value {
                font-size: 2.2rem;
                letter-spacing: 6px;
            }

            .waiting-actions {
                flex-direction: column;
            }

            .waiting-actions button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- ë°°ê²½ íš¨ê³¼ -->
    <div class="bg-effects">
        <div class="gradient-orb orb-1"></div>
        <div class="gradient-orb orb-2"></div>
        <div class="gradient-orb orb-3"></div>
    </div>

    <!-- ê³µí†µ ë„¤ë¹„ë°” -->
    <nav class="navbar">
        <a href="../../../a/index.html" class="nav-logo">
            <span class="nav-logo-text">TicketPro</span>
            <div class="star star-1"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 784.11 815.53"><path class="star-fill" d="M392.05 0c-20.9,210.08 -184.06,378.41 -392.05,407.78 207.96,29.37 371.12,197.68 392.05,407.74 20.93,-210.06 184.09,-378.37 392.05,-407.74 -207.98,-29.38 -371.16,-197.69 -392.06,-407.78z"/></svg></div>
            <div class="star star-2"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 784.11 815.53"><path class="star-fill" d="M392.05 0c-20.9,210.08 -184.06,378.41 -392.05,407.78 207.96,29.37 371.12,197.68 392.05,407.74 20.93,-210.06 184.09,-378.37 392.05,-407.74 -207.98,-29.38 -371.16,-197.69 -392.06,-407.78z"/></svg></div>
            <div class="star star-3"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 784.11 815.53"><path class="star-fill" d="M392.05 0c-20.9,210.08 -184.06,378.41 -392.05,407.78 207.96,29.37 371.12,197.68 392.05,407.74 20.93,-210.06 184.09,-378.37 392.05,-407.74 -207.98,-29.38 -371.16,-197.69 -392.06,-407.78z"/></svg></div>
            <div class="star star-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 784.11 815.53"><path class="star-fill" d="M392.05 0c-20.9,210.08 -184.06,378.41 -392.05,407.78 207.96,29.37 371.12,197.68 392.05,407.74 20.93,-210.06 184.09,-378.37 392.05,-407.74 -207.98,-29.38 -371.16,-197.69 -392.06,-407.78z"/></svg></div>
            <div class="star star-5"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 784.11 815.53"><path class="star-fill" d="M392.05 0c-20.9,210.08 -184.06,378.41 -392.05,407.78 207.96,29.37 371.12,197.68 392.05,407.74 20.93,-210.06 184.09,-378.37 392.05,-407.74 -207.98,-29.38 -371.16,-197.69 -392.06,-407.78z"/></svg></div>
            <div class="star star-6"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 784.11 815.53"><path class="star-fill" d="M392.05 0c-20.9,210.08 -184.06,378.41 -392.05,407.78 207.96,29.37 371.12,197.68 392.05,407.74 20.93,-210.06 184.09,-378.37 392.05,-407.74 -207.98,-29.38 -371.16,-197.69 -392.06,-407.78z"/></svg></div>
        </a>
        <div class="nav-actions" id="navActions">
            <!-- JSë¡œ ë™ì  ìƒì„± -->
        </div>
    </nav>

    <div class="container">
        <!-- íƒ€ì´í‹€ -->
        <div class="page-header">
            <h1>ğŸ‘¥ ì¹œêµ¬ì™€ ëŒ€ê²°</h1>
            <p>ì¹œêµ¬ë¥¼ ì´ˆëŒ€í•˜ì—¬ ì‹¤ì‹œê°„ í‹°ì¼“íŒ… ëŒ€ê²°ì„ ì¦ê¸°ì„¸ìš”!</p>
        </div>

        <!-- ì˜µì…˜ ì„ íƒ (ì´ˆê¸° í™”ë©´) -->
        <div class="option-cards" id="optionCards">
            <div class="option-card create" onclick="showCreateForm()">
                <span class="option-icon">ğŸ </span>
                <h3 class="option-title">ë°© ë§Œë“¤ê¸°</h3>
                <p class="option-desc">ìƒˆë¡œìš´ ëŒ€ê²° ë°©ì„ ë§Œë“¤ê³ <br>ì¹œêµ¬ë¥¼ ì´ˆëŒ€í•˜ì„¸ìš”</p>
            </div>
            <div class="option-card join" onclick="showJoinForm()">
                <span class="option-icon">ğŸšª</span>
                <h3 class="option-title">ë°© ì°¸ê°€í•˜ê¸°</h3>
                <p class="option-desc">ì´ˆëŒ€ ì½”ë“œë¥¼ ì…ë ¥í•˜ì—¬<br>ì¹œêµ¬ ë°©ì— ì°¸ê°€í•˜ì„¸ìš”</p>
            </div>
        </div>

        <!-- ë°© ë§Œë“¤ê¸° í¼ -->
        <div class="form-section" id="createForm">
            <div class="form-title">ğŸ  ë°© ë§Œë“¤ê¸°</div>
            <div class="form-group">
                <label>ì¹´í…Œê³ ë¦¬</label>
                <select id="createGameType">
                    <option value="concert">ğŸµ ì½˜ì„œíŠ¸</option>
                    <option value="goods">ğŸ›ï¸ êµ¿ì¦ˆ</option>
                    <option value="restaurant">ğŸ½ï¸ ì‹ë‹¹</option>
                </select>
            </div>
            <div class="form-group">
                <label>ë‚œì´ë„</label>
                <select id="createDifficulty">
                    <option value="easy">ì‰¬ì›€</option>
                    <option value="normal" selected>ë³´í†µ</option>
                    <option value="hard">ì–´ë ¤ì›€</option>
                </select>
            </div>
            <div class="form-buttons">
                <button class="btn btn-primary" onclick="createRoom()">ë°© ìƒì„±</button>
                <button class="btn btn-secondary" onclick="showOptions()">ì·¨ì†Œ</button>
            </div>
        </div>

        <!-- ë°© ì°¸ê°€ í¼ -->
        <div class="form-section" id="joinForm">
            <div class="form-title">ğŸšª ë°© ì°¸ê°€í•˜ê¸°</div>
            <div class="form-group">
                <label>ì´ˆëŒ€ ì½”ë“œ</label>
                <input type="text" id="joinRoomCode" class="room-code-input"
                       placeholder="ABC123" maxlength="6"
                       oninput="this.value = this.value.toUpperCase()">
            </div>
            <div class="form-buttons">
                <button class="btn btn-primary" onclick="joinRoom()">ì°¸ê°€</button>
                <button class="btn btn-secondary" onclick="showOptions()">ì·¨ì†Œ</button>
            </div>
        </div>

        <!-- ëŒ€ê¸°ì‹¤ -->
        <div class="waiting-room" id="waitingRoom">
            <!-- ë°© ì •ë³´ -->
            <div class="room-info">
                <h2>ğŸ® ëŒ€ê²° ëŒ€ê¸°ì‹¤</h2>
                <div class="room-code-display">
                    <div class="room-code-label">ì´ˆëŒ€ ì½”ë“œ</div>
                    <div class="room-code-value" id="displayRoomCode">------</div>
                </div>
                <button class="copy-btn" onclick="copyRoomCode()">ğŸ“‹ ì½”ë“œ ë³µì‚¬</button>
            </div>

            <!-- í”Œë ˆì´ì–´ ìŠ¬ë¡¯ -->
            <div class="players-section">
                <div class="players-title">ğŸ‘¥ í”Œë ˆì´ì–´ (ìµœëŒ€ 2ëª…)</div>
                <div class="player-slots" id="playerSlots">
                    <div class="player-slot" id="slot1">
                        <div class="player-avatar">â“</div>
                        <div class="empty-slot-text">ëŒ€ê¸° ì¤‘...</div>
                    </div>
                    <div class="player-slot" id="slot2">
                        <div class="player-avatar">â“</div>
                        <div class="empty-slot-text">ëŒ€ê¸° ì¤‘...</div>
                    </div>
                </div>
            </div>

            <!-- ë²„íŠ¼ -->
            <div class="waiting-actions">
                <button class="ready-btn not-ready" id="readyBtn" onclick="toggleReady()">
                    ì¤€ë¹„í•˜ê¸°
                </button>
                <button class="start-btn" id="startBtn" onclick="startGame()" style="display: none;">
                    ê²Œì„ ì‹œì‘
                </button>
                <button class="leave-btn" onclick="leaveRoom()">ë‚˜ê°€ê¸°</button>
            </div>

            <!-- ì±„íŒ… -->
            <div class="chat-section">
                <div class="chat-header">ğŸ’¬ ì±„íŒ…</div>
                <div class="chat-messages" id="chatMessages"></div>
                <div class="chat-input-area">
                    <input type="text" id="chatInput" placeholder="ë©”ì‹œì§€ ì…ë ¥..."
                           onkeypress="handleChatKeypress(event)">
                    <button onclick="sendChat()">ì „ì†¡</button>
                </div>
            </div>
        </div>
    </div>

    <script src="../js/supabase-config.js"></script>
    <script src="../js/friend-battle.js"></script>
    <script>
        // ë„¤ë¹„ë°” ë™ì  ìƒì„±
        function initNavbar() {
            const navActions = document.getElementById('navActions');
            const userId = sessionStorage.getItem('userId');
            const nickname = sessionStorage.getItem('nickname');

            const adminBtn = `<a href="../admin/key-manager.html" class="nav-btn secondary" style="font-size: 11px; padding: 4px 8px; opacity: 0.5; margin-left: 8px;" title="ê´€ë¦¬ì">âš™ï¸</a>`;

            if (userId && nickname) {
                navActions.innerHTML = `
                    <span style="color: var(--text-secondary); font-size: 14px; margin-right: 8px;">ğŸ‘¤ ${nickname}</span>
                    <a href="battle-mode.html" class="nav-btn battle">âš”ï¸ ëŒ€ê²°</a>
                    <a href="../main-pages/ranking.html" class="nav-btn secondary">ğŸ† ìˆœìœ„í‘œ</a>
                    <a href="../main-pages/chat.html" class="nav-btn secondary">ğŸ’¬ ì±„íŒ…</a>
                    <button onclick="logout()" class="nav-btn secondary">ë¡œê·¸ì•„ì›ƒ</button>
                    ${adminBtn}
                `;
            } else {
                navActions.innerHTML = `
                    <a href="battle-mode.html" class="nav-btn battle">âš”ï¸ ëŒ€ê²°</a>
                    <a href="../main-pages/login.html" class="nav-btn secondary">ë¡œê·¸ì¸</a>
                    ${adminBtn}
                `;
            }
        }

        function logout() {
            sessionStorage.removeItem('user_id');
            sessionStorage.removeItem('nickname');
            location.reload();
        }

        let gameRoom = null;
        let isReady = false;

        // ë¡œê·¸ì¸ ì²´í¬
        if (!sessionStorage.getItem('userId')) {
            Swal.fire({
                title: 'ë¡œê·¸ì¸ í•„ìš”',
                text: 'ì¹œêµ¬ ëŒ€ê²°ì„ ì´ìš©í•˜ë ¤ë©´ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.',
                icon: 'warning',
                confirmButtonText: 'ë¡œê·¸ì¸í•˜ê¸°'
            }).then(() => {
                location.href = '../main-pages/choice.html';
            });
        }

        // í™”ë©´ ì „í™˜ í•¨ìˆ˜ë“¤
        function showOptions() {
            document.getElementById('optionCards').style.display = 'grid';
            document.getElementById('createForm').classList.remove('active');
            document.getElementById('joinForm').classList.remove('active');
            document.getElementById('waitingRoom').classList.remove('active');
        }

        function showCreateForm() {
            document.getElementById('optionCards').style.display = 'none';
            document.getElementById('createForm').classList.add('active');
        }

        function showJoinForm() {
            document.getElementById('optionCards').style.display = 'none';
            document.getElementById('joinForm').classList.add('active');
        }

        function showWaitingRoom() {
            document.getElementById('optionCards').style.display = 'none';
            document.getElementById('createForm').classList.remove('active');
            document.getElementById('joinForm').classList.remove('active');
            document.getElementById('waitingRoom').classList.add('active');
        }

        // ë°© ìƒì„±
        async function createRoom() {
            const gameType = document.getElementById('createGameType').value;
            const difficulty = document.getElementById('createDifficulty').value;

            try {
                gameRoom = new GameRoom();
                setupGameRoomCallbacks();

                const result = await gameRoom.createRoom(gameType, difficulty);

                document.getElementById('displayRoomCode').textContent = result.roomCode;

                // í˜¸ìŠ¤íŠ¸ UI ì„¤ì •
                document.getElementById('readyBtn').style.display = 'none';
                document.getElementById('startBtn').style.display = 'inline-block';
                document.getElementById('startBtn').disabled = true;

                showWaitingRoom();
                updatePlayerSlots();
                addSystemMessage('ë°©ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤! ì¹œêµ¬ì—ê²Œ ì´ˆëŒ€ ì½”ë“œë¥¼ ê³µìœ í•˜ì„¸ìš”.');

            } catch (error) {
                Swal.fire('ì˜¤ë¥˜', error.message, 'error');
            }
        }

        // ë°© ì°¸ê°€
        async function joinRoom() {
            const roomCode = document.getElementById('joinRoomCode').value.trim();

            if (roomCode.length !== 6) {
                Swal.fire('ì˜¤ë¥˜', '6ìë¦¬ ì´ˆëŒ€ ì½”ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'warning');
                return;
            }

            try {
                gameRoom = new GameRoom();
                setupGameRoomCallbacks();

                await gameRoom.joinRoom(roomCode);

                document.getElementById('displayRoomCode').textContent = roomCode;

                // ê²ŒìŠ¤íŠ¸ UI ì„¤ì •
                document.getElementById('readyBtn').style.display = 'inline-block';
                document.getElementById('startBtn').style.display = 'none';

                showWaitingRoom();
                updatePlayerSlots();
                addSystemMessage('ë°©ì— ì°¸ê°€í–ˆìŠµë‹ˆë‹¤!');

            } catch (error) {
                Swal.fire('ì˜¤ë¥˜', error.message, 'error');
            }
        }

        // GameRoom ì½œë°± ì„¤ì •
        function setupGameRoomCallbacks() {
            gameRoom.onPlayerJoin = (data) => {
                addSystemMessage(`${data.nickname}ë‹˜ì´ ì°¸ê°€í–ˆìŠµë‹ˆë‹¤.`);
                updatePlayerSlots();
                updateStartButton();
            };

            gameRoom.onSync = (data) => {
                // ë™ê¸°í™”ë¡œ ë°›ì€ ì°¸ê°€ì ì •ë³´
                updatePlayerSlots();
                updateStartButton();
            };

            gameRoom.onPlayerReady = (data) => {
                const status = data.isReady ? 'ì¤€ë¹„ ì™„ë£Œ' : 'ì¤€ë¹„ ì·¨ì†Œ';
                addSystemMessage(`${data.nickname}ë‹˜ì´ ${status}í–ˆìŠµë‹ˆë‹¤.`);
                updatePlayerSlots();
                updateStartButton();
            };

            gameRoom.onPlayerLeave = (data) => {
                // ê²Œì„ ì‹œì‘ ì¤‘ì—ëŠ” í‡´ì¥ ë©”ì‹œì§€ í‘œì‹œí•˜ì§€ ì•ŠìŒ
                if (window.gameStarting) return;

                addSystemMessage(`${data.nickname}ë‹˜ì´ ë‚˜ê°”ìŠµë‹ˆë‹¤.`);
                updatePlayerSlots();
                updateStartButton();
            };

            gameRoom.onCountdown = (data) => {
                Swal.fire({
                    title: data.count,
                    showConfirmButton: false,
                    timer: 900,
                    background: 'rgba(26, 26, 46, 0.95)',
                    color: '#fff'
                });
            };

            gameRoom.onGameStart = (data) => {
                // ê²Œì„ ì‹œì‘ í”Œë˜ê·¸ ì„¤ì • (ë‚˜ê°€ê¸° ë©”ì‹œì§€ ë°©ì§€)
                window.gameStarting = true;

                // ê²Œì„ ì„¤ì • ì €ì¥
                sessionStorage.setItem('friend_battle_roomCode', gameRoom.roomCode);
                sessionStorage.setItem('friend_battle_settings', JSON.stringify(data.settings));
                // í˜¸í™˜ì„±ì„ ìœ„í•´ battle_ í‚¤ì—ë„ ì €ì¥
                sessionStorage.setItem('battle_roomCode', gameRoom.roomCode);
                sessionStorage.setItem('battle_settings', JSON.stringify(data.settings));

                // ê²Œì„ í˜ì´ì§€ë¡œ ì´ë™
                location.href = 'friend-battle-game.html';
            };

            gameRoom.onChatMessage = (data) => {
                addChatMessage(data.nickname, data.message);
            };
        }

        // í”Œë ˆì´ì–´ ìŠ¬ë¡¯ ì—…ë°ì´íŠ¸
        function updatePlayerSlots() {
            const participants = gameRoom.getParticipants();

            // ìŠ¬ë¡¯ ì´ˆê¸°í™”
            for (let i = 1; i <= 2; i++) {
                const slot = document.getElementById(`slot${i}`);
                slot.className = 'player-slot';
                slot.innerHTML = `
                    <div class="player-avatar">â“</div>
                    <div class="empty-slot-text">ëŒ€ê¸° ì¤‘...</div>
                `;
            }

            // í˜¸ìŠ¤íŠ¸ë¥¼ ë¨¼ì €, ê²ŒìŠ¤íŠ¸ë¥¼ ë‚˜ì¤‘ì— ì •ë ¬
            const sorted = participants.sort((a, b) => {
                if (a.isHost && !b.isHost) return -1;
                if (!a.isHost && b.isHost) return 1;
                return 0;
            });

            // ì°¸ê°€ì í‘œì‹œ
            sorted.forEach((p, index) => {
                const slot = document.getElementById(`slot${index + 1}`);
                slot.classList.add('occupied');

                if (p.isHost) slot.classList.add('host');
                if (p.isReady) slot.classList.add('ready');

                let statusClass = p.isReady ? 'ready' : 'waiting';
                let statusText = p.isReady ? 'ì¤€ë¹„ ì™„ë£Œ' : 'ëŒ€ê¸° ì¤‘';
                if (p.isHost) {
                    statusClass = 'host';
                    statusText = 'í˜¸ìŠ¤íŠ¸';
                }

                slot.innerHTML = `
                    <div class="player-avatar">${p.isHost ? 'ğŸ‘‘' : 'ğŸ˜Š'}</div>
                    <div class="player-name">${p.nickname}</div>
                    <span class="player-status ${statusClass}">${statusText}</span>
                `;
            });
        }

        // ì‹œì‘ ë²„íŠ¼ ì—…ë°ì´íŠ¸
        function updateStartButton() {
            if (gameRoom.isHost) {
                const canStart = gameRoom.isAllReady();
                document.getElementById('startBtn').disabled = !canStart;
            }
        }

        // ì¤€ë¹„ í† ê¸€
        function toggleReady() {
            isReady = !isReady;
            gameRoom.setReady(isReady);

            const btn = document.getElementById('readyBtn');
            if (isReady) {
                btn.textContent = 'ì¤€ë¹„ ì·¨ì†Œ';
                btn.classList.remove('not-ready');
            } else {
                btn.textContent = 'ì¤€ë¹„í•˜ê¸°';
                btn.classList.add('not-ready');
            }
        }

        // ê²Œì„ ì‹œì‘
        async function startGame() {
            try {
                await gameRoom.startGame();
            } catch (error) {
                Swal.fire('ì˜¤ë¥˜', error.message, 'warning');
            }
        }

        // ë°© ë‚˜ê°€ê¸°
        async function leaveRoom() {
            const result = await Swal.fire({
                title: 'ë°© ë‚˜ê°€ê¸°',
                text: 'ì •ë§ ë‚˜ê°€ì‹œê² ìŠµë‹ˆê¹Œ?',
                icon: 'question',
                showCancelButton: true,
                confirmButtonText: 'ë‚˜ê°€ê¸°',
                cancelButtonText: 'ì·¨ì†Œ'
            });

            if (result.isConfirmed) {
                if (gameRoom) {
                    await gameRoom.leaveRoom();
                }
                showOptions();
            }
        }

        // ì½”ë“œ ë³µì‚¬
        function copyRoomCode() {
            const code = document.getElementById('displayRoomCode').textContent;
            navigator.clipboard.writeText(code).then(() => {
                Swal.fire({
                    title: 'ë³µì‚¬ ì™„ë£Œ!',
                    text: 'ì´ˆëŒ€ ì½”ë“œê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.',
                    icon: 'success',
                    timer: 1500,
                    showConfirmButton: false
                });
            });
        }

        // ì±„íŒ… ì „ì†¡
        function sendChat() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();

            if (message && gameRoom) {
                gameRoom.sendChat(message);
                input.value = '';
            }
        }

        function handleChatKeypress(e) {
            if (e.key === 'Enter') {
                sendChat();
            }
        }

        function addChatMessage(sender, text) {
            const container = document.getElementById('chatMessages');
            const div = document.createElement('div');
            div.className = 'chat-message';
            div.innerHTML = `<span class="sender">${sender}</span><span class="text">${text}</span>`;
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
        }

        function addSystemMessage(text) {
            const container = document.getElementById('chatMessages');
            const div = document.createElement('div');
            div.className = 'chat-message system';
            div.textContent = text;
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
        }

        // ë’¤ë¡œê°€ê¸°
        function goBack() {
            if (gameRoom) {
                leaveRoom();
            } else {
                location.href = 'battle-mode.html';
            }
        }

        // í˜ì´ì§€ ì–¸ë¡œë“œ ì‹œ ë°© ë‚˜ê°€ê¸°
        window.addEventListener('beforeunload', () => {
            if (gameRoom) {
                gameRoom.leaveRoom();
            }
        });

        // ì´ˆê¸°í™”
        initNavbar();
    </script>
</body>
</html>
