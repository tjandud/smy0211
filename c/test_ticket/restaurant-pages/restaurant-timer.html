<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>í‹°ì¼€íŒ… ê²Œì„ â€” íƒ€ì´ë¨¸</title>
  <style>
    .result-area-card {
      background: rgba(16, 12, 28, 0.75);
      border: 1px solid rgba(120, 119, 198, 0.18);
      border-radius: 22px;
      box-shadow: 0 8px 32px rgba(16,12,28,0.18);
      backdrop-filter: blur(32px);
      -webkit-backdrop-filter: blur(32px);
      padding: 32px 24px;
      color: #fff;
      margin-top: 18px;
      max-width: 420px;
      margin-left: auto;
      margin-right: auto;
      text-align: center;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }
    html,body{
      height:100%;margin:0;
      font-family:'Inter','Noto Sans KR',-apple-system,BlinkMacSystemFont,system-ui,sans-serif;
      background:#0b0a13;
      color:#111827;
      overflow:hidden;
    }
    .bg-effects {
      position: fixed;
      inset: 0;
      z-index: 0;
      pointer-events: none;
    }
    .gradient-orb {
      position: absolute;
      border-radius: 50%;
      filter: blur(80px);
      opacity: 0.7;
      pointer-events: none;
    }
    .gradient-orb-1 {
      width: 700px; height: 700px;
      left: -200px; top: -200px;
      background: radial-gradient(circle at 30% 30%, #a78bfa 0%, #6366f1 80%, transparent 100%);
    }
    .gradient-orb-2 {
      width: 600px; height: 600px;
      right: -180px; top: 0;
      background: radial-gradient(circle at 70% 20%, #c084fc 0%, #a21caf 80%, transparent 100%);
    }
    .gradient-orb-3 {
      width: 500px; height: 500px;
      left: 50%; bottom: -200px; transform: translateX(-50%);
      background: radial-gradient(circle at 50% 80%, #818cf8 0%, #f472b6 80%, transparent 100%);
    }
    .wrap{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:24px}
    .card{width:720px;max-width:92%;text-align:center}
    #pre-count{font-size:120px;font-weight:900;color:#fff;display:none;line-height:1;height:1em}
    /* íƒ€ì´ë¨¸ ìˆ«ì ëŒ€ì‹  ì ì ì  ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ */
    #loading-dots{height:120px;display:flex;align-items:center;justify-content:center;gap:16px}
    .dot{width:22px;height:22px;border-radius:50%;background:#fff;opacity:0.25;animation:blink 900ms infinite}
    .dot:nth-child(2){animation-delay:150ms}
    .dot:nth-child(3){animation-delay:300ms}
    @keyframes blink{0%{opacity:0.2}50%{opacity:1}100%{opacity:0.2}}
    #result-msg{font-size:20px;font-weight:700;color:#fff;margin-bottom:12px}
    @keyframes pulse-red{0%{box-shadow:0 0 0 0 rgba(239,68,68,0.7);transform:scale(1)}50%{box-shadow:0 0 20px 10px rgba(239,68,68,0);transform:scale(1.05)}100%{box-shadow:0 0 0 0 rgba(239,68,68,0);transform:scale(1)}}
    .pulse-red{animation:pulse-red 1s infinite;background:#ef4444!important}
  </style>
</head>
<body>
      <!-- Background Effects (goods/concertì™€ ì™„ì „íˆ ë™ì¼) -->
      <div class="bg-effects">
        <div class="gradient-orb gradient-orb-1"></div>
        <div class="gradient-orb gradient-orb-2"></div>
        <div class="gradient-orb gradient-orb-3"></div>
      </div>
    <!-- ì¹´ì¹´ì˜¤ ì•Œë¦¼ ì‚¬ìš´ë“œ -->
    <audio id="kakaoAlertSound" preload="auto">
      <source src="../audio/ê¹Œí†¡ ì†Œë¦¬.mp3" type="audio/mpeg">
    </audio>
  <!-- ë ˆìŠ¤í† ë‘ ë¯¸ì…˜+íƒ€ì´ë¨¸ í‘œì‹œ (êµ¿ì¦ˆ ê²Œì„ ìŠ¤íƒ€ì¼, ìš°ìƒë‹¨) -->
  <div id="restQuestDisplay" style="position: fixed; top: 20px; right: 20px; background: white; border: 3px solid #00d9c8; border-radius: 12px; padding: 16px; box-shadow: 0 6px 14px rgba(2,6,23,0.25); z-index: 10000; min-width: 280px; display: none;">
    <div style="font-size: 16px; font-weight: 700; color: #1f2937; margin-bottom: 8px; display: flex; align-items: center; gap: 8px;">
      <span>ğŸ“‹ ë ˆìŠ¤í† ë‘ ë¯¸ì…˜</span>
      <span id="restQuestBadge" style="display: inline-block; padding: 4px 10px; border-radius: 4px; font-size: 12px; font-weight: 700; background: #2563EB; color: white;">NORMAL</span>
    </div>
    <div id="restQuestText" style="font-size: 13px; color: #374151; margin-bottom: 8px; line-height: 1.6; padding: 10px; background: #f9fafb; border-radius: 6px;">ë¯¸ì…˜ì„ í™•ì¸í•˜ì„¸ìš”!</div>
    <div id="restQuestList" style="font-size: 13px; color: #111827;"></div>
    <div id="restQuestTimer" style="margin-top:12px; display:flex; justify-content:flex-end;">
      <div style="background:#0b1220;color:#fff;border-radius:10px;padding:6px 10px;font-weight:900;min-width:64px;text-align:center;">
        <span id="restQuestRemain">--:--</span>
      </div>
    </div>
  </div>
  <div class="wrap">
    <div class="card">
      <!-- ê²Œì„ UI: 3-2-1 ì¹´ìš´íŠ¸ ë° 10ì´ˆ íƒ€ì´ë¨¸ -->
      <div id="game-overlay" style="display:flex;position:fixed;inset:0;align-items:center;justify-content:center;background:rgba(15,23,42,0.06);z-index:9999;">
        <div style="width:720px;max-width:92%;background:transparent;padding:24px 20px;text-align:center;color:#fff;">
          <div id="pre-count" style="font-size:120px;font-weight:900;color:#fff;display:none;line-height:1;height:1em;"></div>

          <div id="start-msg" style="display:none;font-size:18px;font-weight:700;color:#fff;margin-bottom:12px;">ì ì‹œ í›„ ê²Œì„ì´ ì‹œì‘ë©ë‹ˆë‹¤</div>

          <div id="timer-area" style="display:none; position:relative;">
            <div id="ready-msg" style="font-size:18px;font-weight:700;color:#fff;margin-bottom:8px;">ê³§ ìºì¹˜í…Œì´ë¸” ì˜ˆì•½ì´ ì‹œì‘ë©ë‹ˆë‹¤.. ì¤€ë¹„í•˜ì„¸ìš”!</div>
              <div id="loading-dots"><span class="dot"></span><span class="dot"></span><span class="dot"></span></div>
            <!-- ì‚¬ì´íŠ¸ ì ‘ì†í•˜ê¸° ë²„íŠ¼ ì œê±°: ë¡œë”©/ì•Œë¦¼ë§Œ í‘œì‹œ -->
            <!-- ì•Œë¦¼ì€ ì‹œê°„ ë„ë˜ ì‹œ ì¤‘ì•™ì— ë‹¨ë… í‘œì‹œ -->
            <div id="kakao-alert" style="display:none;position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);z-index:10;align-items:center;justify-content:center;max-width:520px;width:100%;padding:0 12px;"></div>
            
            <!-- Kakao alert template (inline, uses only component styles) -->
            <template id="kakao-template">
              <style>
                .message-container{width:100%;max-width:480px;position:relative}
                .profile-header{display:flex;align-items:flex-start;gap:8px;margin-bottom:8px;padding:0 16px;position:relative}
                .profile-icon{width:42px;height:42px;background:#ff6b35;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:26px;font-weight:900;color:#fff;flex-shrink:0;line-height:1;padding-bottom:2px}
                .profile-name{font-size:13px;color:#fff;font-weight:600;margin-top:2px}
                .message-bubble{background:#fff;border-radius:0 18px 18px 18px;overflow:visible;box-shadow:0 2px 6px rgba(0,0,0,0.15);margin-left:16px;margin-right:60px;max-width:calc(100% - 76px);position:relative}
                .bubble-header{background:#fee500;padding:12px 18px;font-size:15px;font-weight:700;color:#3c1e1e;letter-spacing:-0.3px}
                .bubble-content{padding:20px 18px}
                .bubble-title{font-size:17px;font-weight:700;color:#000;margin-bottom:20px;line-height:1.4;letter-spacing:-0.3px}
                .bubble-info{font-size:15px;color:#000;line-height:1.9;margin-bottom:2px;letter-spacing:-0.2px}
                .bubble-section{margin-top:20px;padding-top:20px;border-top:1px solid #e8e8e8}
                .bubble-section-title{font-size:15px;font-weight:700;color:#000;margin-bottom:10px;letter-spacing:-0.2px}
                .bubble-note{font-size:14px;color:#333;line-height:1.7;margin-bottom:4px;letter-spacing:-0.2px}
                .bubble-button{margin-top:20px;padding:14px;background:#f5f5f5;border:1px solid #ddd;border-radius:6px;text-align:center;font-size:15px;font-weight:700;color:#333;letter-spacing:-0.3px}
              </style>
              <div class="message-container">
                <div class="profile-header">
                  <div class="profile-icon">C</div>
                  <div class="profile-name">ìºì¹˜í…Œì´ë¸”</div>
                </div>
                <div class="message-bubble">
                  <div class="bubble-header">ì•Œë¦¼í†¡ ë„ì°©</div>
                  <div class="bubble-content">
                    <div class="bubble-title">ì´ìˆ™ìš°íšŒì— ë¹ˆìë¦¬ê°€ ìƒê²¼ì–´ìš”!</div>
                    <div class="bubble-info">[ë‚ ì§œ] : 2021ë…„ 8ì›” 7ì¼ (í† )</div>
                    <div class="bubble-info">[ì‹œê°„] : ì˜¤í›„ 7:30</div>
                    <div class="bubble-info">[ì¸ì›] : 2ëª…</div>
                    <div class="bubble-section">
                      <div class="bubble-section-title">[ìœ ì˜ì‚¬í•­]</div>
                      <div class="bubble-note">* ì§€ê¸ˆ 456ëª…ì´ ì˜ˆì•½ ë„ì „ ì¤‘ì´ì—ìš”.</div>
                      <div class="bubble-note">* ì„ ì°©ìˆœìœ¼ë¡œ ì˜ˆì•½ì´ ì´ë£¨ì–´ì§€ë¯€ë¡œ ë¹ ë¥¸ ì‹œê°„ ë‚´ì— ì˜ˆì•½í•´ ì£¼ì„¸ìš”.</div>
                    </div>
                    <div class="bubble-button">ì•±ìœ¼ë¡œ ê°€ê¸°</div>
                  </div>
                </div>
              </div>
            </template>
          </div>

          <div id="result-area" class="result-area-card" style="display:none;">
            <div id="result-msg" style="font-size:20px;font-weight:700;color:#fff;margin-bottom:12px;"></div>
            <div>
              <button id="retry-btn" type="button" style="background:#fff;color:#2563EB;border:2px solid #2563EB;padding:10px 18px;border-radius:8px;font-weight:700;cursor:pointer;">ë‹¤ì‹œí•˜ê¸°</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
  (function(){
    var overlay = document.getElementById('game-overlay');
    var preCountEl = document.getElementById('pre-count');
    var timerArea = document.getElementById('timer-area');
    var loadingDots = document.getElementById('loading-dots');
    var connectBtn = null; // ë²„íŠ¼ ë¯¸ì‚¬ìš©
    var resultArea = document.getElementById('result-area');
    var resultMsg = document.getElementById('result-msg');
    var retryBtn = document.getElementById('retry-btn');
    var kakaoAlert = document.getElementById('kakao-alert');

    var timerId = null;
    var startTime = 0;
    var duration = 10000;
    var remaining = duration;
    var isReadyToProceed = false; // 7~10ì´ˆ ì‚¬ì´ ì•Œë¦¼ ë“±ì¥ í›„ ì§„í–‰ ê°€ëŠ¥ (ì•±ìœ¼ë¡œ ê°€ê¸° ë²„íŠ¼ í™œì„±)
    
    var urlParams = new URLSearchParams(window.location.search);
    var selectedLevel = urlParams.get('level') || 'normal';

    var levelConfigs = {
      easy:   { duration: 10000, successWindow: 150 },
      normal: { duration: 5000, successWindow: 80 },
      hard:   { duration: 5000,  successWindow: 40 }
    };

    var effective = { duration: duration, successWindow: 0 };
    if(levelConfigs[selectedLevel]){
      effective.duration = levelConfigs[selectedLevel].duration;
      effective.successWindow = levelConfigs[selectedLevel].successWindow;
    }
    duration = effective.duration;
    remaining = duration;

    // ë ˆë²¨ë³„ ì‹ë‹¹ í›„ë³´ì™€ ê°•ì œ alias (test-catchtable-banner.htmlì˜ getShopFromURLì— ë§ì¶¤)
    var levelShops = {
      easy: [ { name:'ì•„í‹°ìŠ¤íŠ¸ ë² ì´ì»¤ë¦¬', alias:'artistbakery' }, { name:'ê¸ˆë¼ì§€ì‹ë‹¹', alias:'goldpig' } ],
      normal: [ { name:'ë„ëŸ‰', alias:'dolyang' }, { name:'í¬ë…¸ ë¶€ì˜¤ë…¸', alias:'ponobouno' }, { name:'í‹°ì—”ë¯¸ë¯¸ í™ëŒ€', alias:'tianmimihongdae' } ],
      hard: [ { name:'ëª¨ìˆ˜ ì„œìš¸', alias:'tempmosuseoul' }, { name:'ë°ê¸€ìŠ¤', alias:'mingles' } ]
    };
    function pickShop(level){
      var arr = levelShops[level] || levelShops['normal'];
      return arr[Math.floor(Math.random()*arr.length)];
    }
    var picked = pickShop(selectedLevel);
    var pickedName = picked.name;
    var pickedAlias = picked.alias;

    // ë ˆë²¨ë³„ ëŒ€ê¸° ì¸ì› ëœë¤ ë²”ìœ„
    function randInt(min,max){ return Math.floor(Math.random()*(max-min+1))+min; }
    var crowdByLevel = {
      easy: randInt(30,50),
      normal: randInt(90,130),
      hard: randInt(4,600)
    };
    var crowd = crowdByLevel[selectedLevel] || randInt(50,120);

    var startMsgEl = document.getElementById('start-msg');
    // í˜ì´ì§€ ì‹œì‘ ì‹œ ë¯¸ì…˜ì„ ë¨¼ì € ìƒì„±/í‘œì‹œ (ì¹´í†¡ ì•Œë¦¼ ì „ì—ë„ ë³´ì´ë„ë¡)
    var initialMission = createMission(selectedLevel);

    function getLimitMs(level){
      if(level === 'easy') return 15000;
      if(level === 'normal') return 7000;
      if(level === 'hard') return 5000;
      return 10000;
    }

    // ë¯¸ì…˜ ìƒì„±: ë‚ ì§œ/ì¸ì›/ì‹œê°„ ì¡°ê±´
    function createMission(level){
      // ì˜¤ëŠ˜/ë‚´ì¼
      var today = new Date();
      var yyyy = today.getFullYear();
      var mm = today.getMonth()+1;
      var ddToday = today.getDate();
      // ì´ë²ˆ ë‹¬ì˜ ë§ì¼ ê³„ì‚° (ì˜¤ëŠ˜ë¶€í„° ë§ì¼ê¹Œì§€ ëœë¤)
      var lastDayOfMonth = new Date(today.getFullYear(), today.getMonth()+1, 0).getDate();
      var randPick = function(arr){ return arr[Math.floor(Math.random()*arr.length)]; };
      var timePool = [ 'ì˜¤ì „ 11:30','ì˜¤í›„ 12:00','ì˜¤í›„ 12:30','ì˜¤í›„ 1:00','ì˜¤í›„ 1:30','ì˜¤í›„ 5:30','ì˜¤í›„ 6:00','ì˜¤í›„ 6:30','ì˜¤í›„ 7:00','ì˜¤í›„ 7:30','ì˜¤í›„ 8:00' ];
      var peoplePool = [1,2,3,4,5,6,7,8,9];

      var condDate = randInt(ddToday, lastDayOfMonth);
      var condPeople = randPick(peoplePool);
      var condTime = randPick(timePool);

      if(level === 'easy'){
        return { type: 'any', rules: [] };
      }
      if(level === 'normal'){
        // í•œ ê°€ì§€ ì¡°ê±´ë§Œ ìš”êµ¬
        var which = randPick(['date','people','time']);
        var rule = {};
        if(which==='date') rule = { kind:'date', value: condDate };
        if(which==='people') rule = { kind:'people', value: condPeople };
        if(which==='time') rule = { kind:'time', value: condTime };
        return { type:'one', rules:[rule] };
      }
      // hard: ë‘ ê°œ ë˜ëŠ” ì„¸ ê°œ ì¡°ê±´
      var count = randPick([2,3]);
      var bag = [ {kind:'date', value: condDate}, {kind:'people', value: condPeople}, {kind:'time', value: condTime} ];
      // ì…”í”Œ í›„ ì•ì—ì„œ count ì„ íƒ
      for(var i=bag.length-1;i>0;i--){ var j=Math.floor(Math.random()* (i+1)); var tmp=bag[i]; bag[i]=bag[j]; bag[j]=tmp; }
      return { type:'multi', need: count, rules: bag.slice(0,count) };
    }

    function runPreCount(){
      return new Promise(function(resolve){
        if(startMsgEl) startMsgEl.style.display = 'block';
        preCountEl.style.display = 'block';
        timerArea.style.display = 'none';
        resultArea.style.display = 'none';
        var nums = ['3','2','1'];
        var i = 0;
        preCountEl.textContent = nums[i];
        var pc = setInterval(function(){
          i++;
          if(i < nums.length){
            preCountEl.textContent = nums[i];
          } else {
            clearInterval(pc);
            preCountEl.style.display = 'none';
            if(startMsgEl) startMsgEl.style.display = 'none';
            resolve();
          }
        }, 1000);
      });
    }

    // ìˆ«ì í‘œì‹œëŠ” ì‚¬ìš©í•˜ì§€ ì•ŠìŒ (ì ì ì  ì• ë‹ˆë©”ì´ì…˜ìœ¼ë¡œ ëŒ€ì²´)

    function startTenTimer(){
      timerArea.style.display = 'block';
      resultArea.style.display = 'none';
      startTime = performance.now();
      window._timerEndTime = null;
      // 7~10ì´ˆ ì‚¬ì´ ëœë¤ ì‹œì ì— ì¹´ì¹´ì˜¤ ì•Œë¦¼ í‘œì‹œ
      var alertDelay = 7000 + Math.floor(Math.random() * 3001); // 7000~10000ms
      var alertShown = false;
      function tick(){
        var now = performance.now();
        var elapsed = now - startTime;
        remaining = Math.max(0, duration - elapsed);
        if(!alertShown && elapsed >= alertDelay){
          alertShown = true;
          isReadyToProceed = true;
          // ì•Œë¦¼ ì‚¬ìš´ë“œ ì¬ìƒ (ì „ì—­ ìŒì†Œê±° ìƒíƒœê°€ ì•„ë‹ ë•Œë§Œ)
          try {
            var audio = document.getElementById('kakaoAlertSound');
            var globalMute = localStorage.getItem('globalSound') === 'off';
            if(audio && !globalMute){ audio.currentTime = 0; audio.play().catch(function(){}); }
          } catch(e){}
          // ì¹´ì¹´ì˜¤ ì•Œë¦¼ ì½˜í…ì¸  ë¡œë“œ ë° ì‚½ì…
          // í…œí”Œë¦¿ì„ í´ë¡ í•˜ì—¬ ì‚½ì… (íŒŒì¼ í˜ì¹˜ ì—†ì´ ë™ì‘)
          var tpl = document.getElementById('kakao-template');
          kakaoAlert.innerHTML = '';
          kakaoAlert.appendChild(tpl.content.cloneNode(true));
          kakaoAlert.style.display = 'flex';
          // ë¡œë”©/ì•ˆë‚´ë¬¸ ì™„ì „ ìˆ¨ê¹€ ì²˜ë¦¬ë¡œ ì•Œë¦¼ë§Œ ì¤‘ì•™ì— í‘œì‹œ
          var readyMsgEl = document.getElementById('ready-msg');
          if(readyMsgEl) readyMsgEl.style.display = 'none';
          loadingDots.style.display = 'none';
          // í…œí”Œë¦¿ ë‚´ 'ì•±ìœ¼ë¡œ ê°€ê¸°' ë²„íŠ¼ì„ ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ìœ¼ë¡œ ë°”ì¸ë”©
          var goBtn = kakaoAlert.querySelector('.bubble-button');
          // í…ìŠ¤íŠ¸/ì½˜í…ì¸  ì—…ë°ì´íŠ¸: ì‹ë‹¹ëª…/ì•ˆë‚´/ëŒ€ê¸° ì¸ì›
          var bubbleHeader = kakaoAlert.querySelector('.bubble-header');
          var bubbleContent = kakaoAlert.querySelector('.bubble-content');
          if(bubbleHeader) bubbleHeader.textContent = 'ì•Œë¦¼í†¡ ë„ì°©';
          if(bubbleContent){
            bubbleContent.innerHTML = ''+
              '<div class="bubble-title">ì§€ê¸ˆ '+pickedName+'ì˜ ì˜ˆì•½ì´ ì‹œì‘ëì–´ìš”!</div>'+
              '<div class="bubble-info">ì§€ê¸ˆ ë°”ë¡œ ì˜ˆì•½ì„ ì‹œì‘í•´ì£¼ì„¸ìš”!</div>'+
              '<div class="bubble-section">'+
              '  <div class="bubble-section-title">[ìœ ì˜ì‚¬í•­]</div>'+
              '  <div class="bubble-note">* ì§€ê¸ˆ '+crowd+'ëª…ì´ ì˜ˆì•½ ë„ì „ ì¤‘ì´ì—ìš”.</div>'+
              '  <div class="bubble-note">* ì„ ì°©ìˆœìœ¼ë¡œ ì˜ˆì•½ì´ ì´ë£¨ì–´ì§€ë¯€ë¡œ ë¹ ë¥¸ ì‹œê°„ ë‚´ì— ì˜ˆì•½í•´ ì£¼ì„¸ìš”.</div>'+
              '</div>'+
              '<div class="bubble-button">ì•±ìœ¼ë¡œ ê°€ê¸°</div>';
          }
          // innerHTMLë¡œ êµì²´ í›„ ë²„íŠ¼ì„ ë‹¤ì‹œ ì„ íƒ
          goBtn = kakaoAlert.querySelector('.bubble-button');
          if(goBtn){
            // ìºì¹˜í…Œì´ë¸” í…Œë§ˆìƒ‰(ì£¼í™©) ì ìš©
            goBtn.style.cursor = 'pointer';
            goBtn.style.background = '#ff6a00';
            goBtn.style.color = '#fff';
            goBtn.style.border = '0';
            goBtn.style.boxShadow = '0 8px 20px rgba(255,106,0,0.3)';
            // ì´ë¯¸ ì´ˆê¸° ìƒì„±ëœ ë¯¸ì…˜ ì‚¬ìš© (ì´ˆê¸°ë¶€í„° í‘œì‹œë˜ì–´ ìˆì–´ì•¼ í•¨)
            var mission = initialMission || createMission(selectedLevel);
            var limitMs = getLimitMs(selectedLevel);
            var endAt = Date.now() + limitMs; // ì•Œë¦¼ ëœ¬ ì‹œì ë¶€í„° ì¹´ìš´íŠ¸
            // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ë¡œ ì „ë‹¬ (banner í˜ì´ì§€ì—ì„œ ê²€ì¦)
            try {
              var payload = { shopAlias: pickedAlias, mission: mission, endAt: endAt };
              localStorage.setItem('ct_mission', JSON.stringify(payload));
            } catch(e) {}
            // íƒ€ì´ë¨¸ í˜ì´ì§€ì—ì„œë„ ë¯¸ì…˜ í‘œì‹œ/ì¹´ìš´íŠ¸ë‹¤ìš´ ì‹œì‘
            showRestMissionOverlay(selectedLevel, mission, endAt);
            goBtn.addEventListener('click', function(){
              // ë ˆìŠ¤í† ë‘ ë©”ì¸ ë°°ë„ˆ í˜ì´ì§€ë¡œ ì´ë™ (ë™ì¼ í´ë”)
              window.location.href = './restaurant-main.html?shop='+encodeURIComponent(pickedAlias)+'&level='+encodeURIComponent(selectedLevel);
            });
          }
        }
        // ì´ˆê¸° ëŒ€ê¸° ë¡œì§ì€ ì•Œë¦¼ í‘œì‹œ ì „ê¹Œì§€ëŠ” ê³„ì† ì§„í–‰ë˜ì–´ì•¼ í•¨
        if(alertShown && remaining <= 0){
          cancelAnimationFrame(timerId);
          timerId = null;
          if(!window._timerEndTime) window._timerEndTime = performance.now();
          return;
        }
        timerId = requestAnimationFrame(tick);
      }
      timerId = requestAnimationFrame(tick);
    }

    function stopTenTimer(){ if(timerId) { cancelAnimationFrame(timerId); timerId = null; } }

    function showResult(msg){
      resultMsg.textContent = msg;
      resultArea.style.display = 'block';
      timerArea.style.display = 'none';
    }

    async function startGame(){
      // ì•Œë¦¼ ì „ì—ë„ ë¯¸ì…˜ íŒ¨ë„ì€ ë³´ì—¬ì•¼ í•¨
      showRestMissionOverlay(selectedLevel, initialMission, null);
      await runPreCount();
      startTenTimer();
    }

    // ë³„ë„ì˜ ì ‘ì† ë²„íŠ¼ ë¡œì§ì€ ì œê±° (ì•Œë¦¼ì˜ 'ì•±ìœ¼ë¡œ ê°€ê¸°'ë¥¼ ì‚¬ìš©)

    retryBtn.addEventListener('click', function(){
      resultArea.style.display = 'none';
      // ë²„íŠ¼ íš¨ê³¼ ì—†ìŒ
      kakaoAlert.style.display = 'none';
      // ë¡œë”©/ì•ˆë‚´ë¬¸ ë³µêµ¬
      var readyMsgEl2 = document.getElementById('ready-msg');
      if(readyMsgEl2) readyMsgEl2.style.display = '';
      loadingDots.style.display = '';
      isReadyToProceed = false;
      remaining = duration;
      startGame();
    });

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ì‹œì‘
    window.addEventListener('DOMContentLoaded', function(){
      startGame();
    });
  })();
  </script>
  <script>
  // ë¯¸ì…˜ ì˜¤ë²„ë ˆì´ í‘œì‹œ/íƒ€ì´ë¨¸ (êµ¿ì¦ˆ ê²Œì„ íë¦„ê³¼ ìœ ì‚¬)
  (function(){
    var badge = document.getElementById('restQuestBadge');
    var textEl = document.getElementById('restQuestText');
    var listEl = document.getElementById('restQuestList');
    var panel = document.getElementById('restQuestDisplay');
    var remainEl = document.getElementById('restQuestRemain');
    var reqAnimId = null;

    window.showRestMissionOverlay = function(level, mission, endAt){
      if(!panel) return;
      // ë°°ì§€ ìƒ‰ìƒ
      badge.textContent = level.toUpperCase();
      if(level==='easy') badge.style.background = '#22c55e';
      else if(level==='normal') badge.style.background = '#2563EB';
      else badge.style.background = '#ef4444';
      // í…ìŠ¤íŠ¸/ë¦¬ìŠ¤íŠ¸
      // ë ˆë²¨ë³„ ì•ˆë‚´ ë¬¸êµ¬
      if(level==='easy'){
        textEl.textContent = 'ì–´ë–¤ ì¡°ê±´ì´ë“  ì˜ˆì•½ì„ ì„±ê³µì‹œì¼œë³´ì„¸ìš”!';
      } else {
        textEl.textContent = 'ë‹¤ìŒ ì¡°ê±´ì„ ë§Œì¡±í•´ì£¼ì„¸ìš”.';
      }
      // ì²´í¬ë¦¬ìŠ¤íŠ¸ ì‹œê°(êµ¿ì¦ˆ ë¯¸ì…˜ì°½ê³¼ ë™ì¼ ìŠ¤íƒ€ì¼)ìœ¼ë¡œ í‘œì‹œ
      function checklistItem(rule, idx){
        return (
          '<div class="quest-item" id="rest-quest-item-'+idx+'" style="display:flex;align-items:center;gap:8px;margin-bottom:8px;padding:8px;background:#f3f4f6;border-radius:6px;">'
          + '<div class="quest-checkbox" style="width:18px;height:18px;border:2px solid #9ca3af;border-radius:3px;display:flex;align-items:center;justify-content:center;font-size:12px;"></div>'
          + '<div>'+formatRestRule(rule)+'</div>'
          + '</div>'
        );
      }
      if(mission.type==='any'){
        listEl.innerHTML = '';
      } else if(mission.type==='one'){
        listEl.innerHTML = checklistItem(mission.rules[0], 0);
      } else {
        listEl.innerHTML = mission.rules.map(function(r,i){ return checklistItem(r,i); }).join('');
      }
      // ì¹´ìš´íŠ¸ë‹¤ìš´ (endAt ì—†ìœ¼ë©´ --:-- ìœ ì§€)
      function tick(){
        if(!endAt){ remainEl.textContent = '--:--'; return; }
        var r = Math.max(0, endAt - Date.now());
        var s = Math.floor(r/1000);
        var mm = String(Math.floor(s/60)).padStart(2,'0');
        var ss = String(s%60).padStart(2,'0');
        remainEl.textContent = mm+':'+ss;
        if(r<=0){ cancelAnimationFrame(reqAnimId); reqAnimId=null; }
        else { reqAnimId = requestAnimationFrame(tick); }
      }
      if(reqAnimId) cancelAnimationFrame(reqAnimId);
      reqAnimId = requestAnimationFrame(tick);
      panel.style.display = 'block';
    };

    function formatRestRule(rule){
      if(rule.kind==='date') return 'ë‚ ì§œ: '+rule.value+'ì¼';
      if(rule.kind==='people') return 'ì¸ì›: '+rule.value+'ëª…';
      if(rule.kind==='time') return 'ì‹œê°„: '+rule.value;
      return 'ì•Œ ìˆ˜ ì—†ëŠ” ì¡°ê±´';
    }
  })();
  </script>
  
</body>
</html>
 = String(s%60).padStart(2,'0');
        remainEl.textContent = mm+':'+ss;
        if(r<=0){ cancelAnimationFrame(reqAnimId); reqAnimId=null; }
        else { reqAnimId = requestAnimationFrame(tick); }
      }
      if(reqAnimId) cancelAnimationFrame(reqAnimId);
      reqAnimId = requestAnimationFrame(tick);
      panel.style.display = 'block';
    };

    function formatRestRule(rule){
      if(rule.kind==='date') return 'ë‚ ì§œ: '+rule.value+'ì¼';
      if(rule.kind==='people') return 'ì¸ì›: '+rule.value+'ëª…';
      if(rule.kind==='time') return 'ì‹œê°„: '+rule.value;
      return 'ì•Œ ìˆ˜ ì—†ëŠ” ì¡°ê±´';
    }
  })();
  </script>
  
</body>
</html>
