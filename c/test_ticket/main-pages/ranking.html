<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <title>TicketPro - ìˆœìœ„í‘œ</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Noto+Sans+KR:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg: #08080c;
            --card: rgba(16, 12, 28, 0.75);
            --card-hover: rgba(22, 16, 38, 0.85);
            --border: rgba(70, 50, 120, 0.2);
            --border-hover: rgba(139, 92, 246, 0.35);
            --text-primary: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.7);
            --text-muted: rgba(255, 255, 255, 0.45);
            --accent-purple: #8b5cf6;
            --accent-violet: #a78bfa;
            --accent-pink: #ec4899;
            --accent-blue: #3b82f6;
            --accent-green: #10b981;
            --accent-orange: #f97316;
            --accent-gold: #fbbf24;
            --accent-silver: #9ca3af;
            --accent-bronze: #d97706;
            --gradient-purple: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%);
            --gradient-blue: linear-gradient(135deg, #3b82f6 0%, #06b6d4 100%);
            --gradient-orange: linear-gradient(135deg, #f97316 0%, #ec4899 100%);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', 'Noto Sans KR', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
            background: var(--bg);
            color: var(--text-primary);
            min-height: 100vh;
        }

        /* Background Effects */
        .bg-effects {
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 0;
        }

        .gradient-orb {
            position: absolute;
            border-radius: 50%;
            filter: blur(120px);
        }

        .gradient-orb-1 {
            width: 500px;
            height: 500px;
            background: rgba(139, 92, 246, 0.25);
            top: -100px;
            right: -100px;
        }

        .gradient-orb-2 {
            width: 400px;
            height: 400px;
            background: rgba(236, 72, 153, 0.2);
            bottom: -100px;
            left: -100px;
        }

        /* ë„¤ë¹„ê²Œì´ì…˜ */
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            padding: 16px 32px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(8, 8, 12, 0.9);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border);
        }

        .nav-logo {
            position: relative;
            display: flex;
            align-items: center;
            gap: 10px;
            text-decoration: none;
            padding: 10px 24px;
            background: linear-gradient(135deg, #8b5cf6 0%, #a855f7 50%, #ec4899 100%);
            border: 2px solid #a78bfa;
            border-radius: 12px;
            box-shadow: 0 0 0 rgba(139, 92, 246, 0.5);
            transition: all 0.3s ease-in-out;
            cursor: pointer;
            overflow: visible;
        }

        .nav-logo:hover {
            background: transparent;
            box-shadow: 0 0 25px rgba(139, 92, 246, 0.6);
        }

        .nav-logo-text {
            font-size: 16px;
            font-weight: 700;
            color: #ffffff;
            z-index: 2;
            transition: all 0.3s ease;
        }

        .nav-logo:hover .nav-logo-text {
            background: var(--gradient-purple);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* ë³„ ì• ë‹ˆë©”ì´ì…˜ */
        .nav-logo .star {
            position: absolute;
            width: 20px;
            height: auto;
            filter: drop-shadow(0 0 0 #e0d4ff);
            z-index: -5;
            transition: all 1s cubic-bezier(0.05, 0.83, 0.43, 0.96);
        }

        .nav-logo .star svg {
            width: 100%;
            height: 100%;
        }

        .nav-logo .star-1 { top: 50%; left: 20%; width: 18px; transform: translateY(-50%); }
        .nav-logo .star-2 { top: 50%; left: 50%; width: 12px; transform: translate(-50%, -50%); }
        .nav-logo .star-3 { top: 50%; left: 35%; width: 6px; transform: translateY(-50%); }
        .nav-logo .star-4 { top: 50%; left: 65%; width: 8px; transform: translateY(-50%); }
        .nav-logo .star-5 { top: 50%; left: 75%; width: 14px; transform: translateY(-50%); }
        .nav-logo .star-6 { top: 50%; left: 85%; width: 5px; transform: translateY(-50%); }

        .nav-logo:hover .star-1 { top: -60%; left: -15%; width: 22px; filter: drop-shadow(0 0 10px #c4b5fd); z-index: 2; transform: translateY(0); }
        .nav-logo:hover .star-2 { top: -30%; left: 5%; width: 14px; filter: drop-shadow(0 0 10px #a78bfa); z-index: 2; transform: translate(0, 0); }
        .nav-logo:hover .star-3 { top: 70%; left: 15%; width: 6px; filter: drop-shadow(0 0 8px #ec4899); z-index: 2; transform: translateY(0); }
        .nav-logo:hover .star-4 { top: 20%; left: 90%; width: 10px; filter: drop-shadow(0 0 10px #c4b5fd); z-index: 2; transform: translateY(0); }
        .nav-logo:hover .star-5 { top: -40%; left: 105%; width: 16px; filter: drop-shadow(0 0 12px #a78bfa); z-index: 2; transform: translateY(0); }
        .nav-logo:hover .star-6 { top: 80%; left: 95%; width: 6px; filter: drop-shadow(0 0 8px #ec4899); z-index: 2; transform: translateY(0); }

        .star-fill { fill: #e0d4ff; }

        .nav-actions {
            display: flex;
            gap: 12px;
        }

        .nav-btn {
            padding: 10px 20px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-primary);
        }

        .nav-btn:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: var(--border-hover);
        }

        /* ë©”ì¸ ì»¨í…Œì´ë„ˆ */
        .main-container {
            position: relative;
            z-index: 10;
            max-width: 1200px;
            margin: 0 auto;
            padding: 100px 32px 40px;
        }

        /* í˜ì´ì§€ í—¤ë” */
        .page-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .page-title {
            font-size: 36px;
            font-weight: 800;
            margin-bottom: 12px;
        }

        .page-title .gradient-text {
            background: var(--gradient-purple);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .page-subtitle {
            color: var(--text-secondary);
            font-size: 16px;
        }

        /* í•„í„° íƒ­ */
        .filter-tabs {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-bottom: 32px;
            flex-wrap: wrap;
        }

        .filter-tab {
            padding: 12px 24px;
            border-radius: 12px;
            border: 1px solid var(--border);
            background: var(--card);
            color: var(--text-secondary);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .filter-tab:hover {
            border-color: var(--border-hover);
            color: var(--text-primary);
        }

        .filter-tab.active {
            background: var(--gradient-purple);
            border-color: transparent;
            color: white;
        }

        /* ë‚œì´ë„ í•„í„° */
        .difficulty-tabs {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 32px;
        }

        .difficulty-tab {
            padding: 8px 16px;
            border-radius: 8px;
            border: none;
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-muted);
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .difficulty-tab:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-secondary);
        }

        .difficulty-tab.active {
            background: rgba(139, 92, 246, 0.2);
            color: var(--accent-violet);
        }

        /* ê²€ìƒ‰ ë°” */
        .search-bar {
            max-width: 600px;
            margin: 0 auto 40px;
            position: relative;
        }

        .search-input {
            width: 100%;
            height: 50px;
            padding: 0 20px 0 50px;
            border-radius: 12px;
            border: 1px solid var(--border);
            background: var(--card);
            color: var(--text-primary);
            font-size: 15px;
            font-family: inherit;
            outline: none;
            transition: all 0.2s ease;
        }

        .search-input:focus {
            border-color: var(--accent-purple);
            box-shadow: 0 0 10px rgba(139, 92, 246, 0.2);
        }

        .search-bar::before {
            content: 'ğŸ”';
            position: absolute;
            left: 18px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 18px;
            color: var(--text-muted);
            z-index: 1;
        }

        /* ë­í‚¹ í…Œì´ë¸” */
        .ranking-card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 20px;
            overflow: hidden;
            backdrop-filter: blur(20px);
        }

        .ranking-header {
            display: grid;
            grid-template-columns: 80px 1fr 120px 120px 120px;
            padding: 16px 24px;
            background: rgba(255, 255, 255, 0.03);
            border-bottom: 1px solid var(--border);
            font-size: 13px;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .ranking-list {
            max-height: 600px;
            overflow-y: auto;
        }

        .ranking-item {
            display: grid;
            grid-template-columns: 80px 1fr 120px 120px 120px;
            padding: 16px 24px;
            align-items: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.03);
            transition: background 0.2s ease;
        }

        .ranking-item:hover {
            background: rgba(255, 255, 255, 0.02);
        }

        .ranking-item.me {
            background: rgba(139, 92, 246, 0.1);
            border-left: 3px solid var(--accent-purple);
        }

        .rank {
            font-size: 18px;
            font-weight: 700;
        }

        .rank.gold { color: var(--accent-gold); }
        .rank.silver { color: var(--accent-silver); }
        .rank.bronze { color: var(--accent-bronze); }

        .rank-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            font-size: 16px;
        }

        .rank-badge.gold { background: rgba(251, 191, 36, 0.2); }
        .rank-badge.silver { background: rgba(156, 163, 175, 0.2); }
        .rank-badge.bronze { background: rgba(217, 119, 6, 0.2); }

        .player-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .player-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--gradient-purple);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: 700;
        }

        .player-name {
            font-weight: 600;
            font-size: 15px;
        }

        .time-value {
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', monospace;
            font-size: 16px;
            font-weight: 600;
            color: var(--accent-green);
        }

        .date-value {
            font-size: 13px;
            color: var(--text-muted);
        }

        /* ë‚œì´ë„ ë°°ì§€ */
        .difficulty-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
            margin-left: 8px;
        }

        .difficulty-badge.easy {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
        }

        .difficulty-badge.normal {
            background: rgba(251, 191, 36, 0.2);
            color: #fbbf24;
        }

        .difficulty-badge.hard {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        /* ì¹´í…Œê³ ë¦¬ ë°°ì§€ */
        .category-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
        }

        .category-badge.concert {
            background: rgba(139, 92, 246, 0.2);
            color: #a78bfa;
        }

        .category-badge.goods {
            background: rgba(59, 130, 246, 0.2);
            color: #60a5fa;
        }

        .category-badge.restaurant {
            background: rgba(249, 115, 22, 0.2);
            color: #fb923c;
        }

        /* ë¡œë”© ìƒíƒœ */
        .loading {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-muted);
        }

        .spinner {
            display: inline-block;
            width: 32px;
            height: 32px;
            border: 3px solid rgba(139, 92, 246, 0.2);
            border-top-color: var(--accent-purple);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin-bottom: 12px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ë¹ˆ ìƒíƒœ */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-muted);
        }

        .empty-state .icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        /* ë‚´ ê¸°ë¡ ì¹´ë“œ */
        .my-record-card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 32px;
        }

        .my-record-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-muted);
            margin-bottom: 16px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .my-record-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
        }

        .my-record-item {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            padding: 16px;
            text-align: center;
        }

        .my-record-label {
            font-size: 12px;
            color: var(--text-muted);
            margin-bottom: 8px;
        }

        .my-record-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--accent-violet);
        }

        @media (max-width: 900px) {
            .ranking-header,
            .ranking-item {
                grid-template-columns: 50px 1fr 80px 100px;
            }

            /* ë‚ ì§œ ì—´ ìˆ¨ê¹€ */
            .ranking-header > *:last-child,
            .ranking-item > *:last-child {
                display: none;
            }
        }

        @media (max-width: 600px) {
            .ranking-header,
            .ranking-item {
                grid-template-columns: 40px 1fr 70px;
            }

            /* ì¹´í…Œê³ ë¦¬ ì—´ë„ ìˆ¨ê¹€ */
            .ranking-header > *:nth-child(4),
            .ranking-item > *:nth-child(4) {
                display: none;
            }

            .filter-tabs {
                gap: 8px;
            }

            .filter-tab {
                padding: 10px 16px;
                font-size: 13px;
            }

            .difficulty-tabs {
                gap: 4px;
            }

            .difficulty-tab {
                padding: 6px 12px;
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <!-- Background Effects -->
    <div class="bg-effects">
        <div class="gradient-orb gradient-orb-1"></div>
        <div class="gradient-orb gradient-orb-2"></div>
    </div>

    <!-- ë„¤ë¹„ê²Œì´ì…˜ -->
    <nav class="navbar">
        <a href="../../../a/index.html" class="nav-logo">
            <span class="nav-logo-text">TicketPro</span>
            <div class="star star-1"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 784.11 815.53"><path class="star-fill" d="M392.05 0c-20.9,210.08 -184.06,378.41 -392.05,407.78 207.96,29.37 371.12,197.68 392.05,407.74 20.93,-210.06 184.09,-378.37 392.05,-407.74 -207.98,-29.38 -371.16,-197.69 -392.06,-407.78z"/></svg></div>
            <div class="star star-2"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 784.11 815.53"><path class="star-fill" d="M392.05 0c-20.9,210.08 -184.06,378.41 -392.05,407.78 207.96,29.37 371.12,197.68 392.05,407.74 20.93,-210.06 184.09,-378.37 392.05,-407.74 -207.98,-29.38 -371.16,-197.69 -392.06,-407.78z"/></svg></div>
            <div class="star star-3"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 784.11 815.53"><path class="star-fill" d="M392.05 0c-20.9,210.08 -184.06,378.41 -392.05,407.78 207.96,29.37 371.12,197.68 392.05,407.74 20.93,-210.06 184.09,-378.37 392.05,-407.74 -207.98,-29.38 -371.16,-197.69 -392.06,-407.78z"/></svg></div>
            <div class="star star-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 784.11 815.53"><path class="star-fill" d="M392.05 0c-20.9,210.08 -184.06,378.41 -392.05,407.78 207.96,29.37 371.12,197.68 392.05,407.74 20.93,-210.06 184.09,-378.37 392.05,-407.74 -207.98,-29.38 -371.16,-197.69 -392.06,-407.78z"/></svg></div>
            <div class="star star-5"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 784.11 815.53"><path class="star-fill" d="M392.05 0c-20.9,210.08 -184.06,378.41 -392.05,407.78 207.96,29.37 371.12,197.68 392.05,407.74 20.93,-210.06 184.09,-378.37 392.05,-407.74 -207.98,-29.38 -371.16,-197.69 -392.06,-407.78z"/></svg></div>
            <div class="star star-6"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 784.11 815.53"><path class="star-fill" d="M392.05 0c-20.9,210.08 -184.06,378.41 -392.05,407.78 207.96,29.37 371.12,197.68 392.05,407.74 20.93,-210.06 184.09,-378.37 392.05,-407.74 -207.98,-29.38 -371.16,-197.69 -392.06,-407.78z"/></svg></div>
        </a>
        <div class="nav-actions" id="navActions">
        </div>
    </nav>

    <!-- ë¡œê·¸ì¸ ìƒíƒœ ì²´í¬ -->
    <script>
    (function() {
        const navActions = document.getElementById('navActions');
        const userId = sessionStorage.getItem('userId');
        const nickname = sessionStorage.getItem('nickname');
        const adminBtn = `<a href="../admin/key-manager.html" class="nav-btn" style="font-size: 11px; padding: 4px 8px; opacity: 0.5; margin-left: 8px;" title="ê´€ë¦¬ì">âš™ï¸</a>`;
        if (userId && nickname) {
            navActions.innerHTML = `
                <span style="color: var(--text-secondary); font-size: 14px; margin-right: 8px;">ğŸ‘¤ ${nickname}</span>
                <a href="../battle-pages/battle-mode.html" class="nav-btn" style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(249, 115, 22, 0.2)); border-color: rgba(239, 68, 68, 0.4); color: #f87171;">âš”ï¸ ëŒ€ê²°</a>
                <a href="ranking.html" class="nav-btn">ğŸ† ìˆœìœ„í‘œ</a>
                <a href="chat.html" class="nav-btn">ğŸ’¬ ì±„íŒ…</a>
                <button onclick="logout()" class="nav-btn">ë¡œê·¸ì•„ì›ƒ</button>
                ${adminBtn}
            `;
        } else {
            navActions.innerHTML = `
                <a href="login.html" class="nav-btn primary">ë¡œê·¸ì¸</a>
                ${adminBtn}
            `;
        }
    })();
    function logout() {
        sessionStorage.removeItem('userId');
        sessionStorage.removeItem('nickname');
        location.reload();
    }
    </script>

    <!-- ë©”ì¸ ì»¨í…Œì´ë„ˆ -->
    <div class="main-container">
        <div class="page-header">
            <h1 class="page-title"><span class="gradient-text">ìˆœìœ„í‘œ</span></h1>
            <p class="page-subtitle">ê°€ì¥ ë¹ ë¥¸ í‹°ì¼“íŒ… ê¸°ë¡ì„ í™•ì¸í•˜ì„¸ìš”</p>
        </div>

        <!-- ì¹´í…Œê³ ë¦¬ í•„í„° -->
        <div class="filter-tabs">
            <button class="filter-tab active" data-category="all">ì „ì²´</button>
            <button class="filter-tab" data-category="ì½˜ì„œíŠ¸">ì½˜ì„œíŠ¸</button>
            <button class="filter-tab" data-category="êµ¿ì¦ˆ">êµ¿ì¦ˆ</button>
            <button class="filter-tab" data-category="ì‹ë‹¹">ì‹ë‹¹</button>
        </div>

        <!-- ë‚œì´ë„ í•„í„° -->
        <div class="difficulty-tabs">
            <button class="difficulty-tab active" data-difficulty="all">ì „ì²´</button>
            <button class="difficulty-tab" data-difficulty="ì‰¬ì›€">ì‰¬ì›€</button>
            <button class="difficulty-tab" data-difficulty="ë³´í†µ">ë³´í†µ</button>
            <button class="difficulty-tab" data-difficulty="ì–´ë ¤ì›€">ì–´ë ¤ì›€</button>
        </div>

        <!-- ê²€ìƒ‰ ë°” -->
        <div class="search-bar">
            <input type="text" id="searchInput" class="search-input" placeholder="í”Œë ˆì´ì–´ ì´ë¦„ ê²€ìƒ‰...">
        </div>

        <!-- ë‚´ ê¸°ë¡ -->
        <div class="my-record-card" id="myRecordCard" style="display: none;">
            <div class="my-record-title">ë‚˜ì˜ ê¸°ë¡</div>
            <div class="my-record-grid" id="myRecordGrid">
                <!-- ë™ì ìœ¼ë¡œ ì±„ì›Œì§ -->
            </div>
        </div>

        <!-- ë­í‚¹ í…Œì´ë¸” -->
        <div class="ranking-card">
            <div class="ranking-header" id="rankingHeader">
                <div>ìˆœìœ„</div>
                <div>í”Œë ˆì´ì–´</div>
                <div>ê¸°ë¡</div>
                <div>ì¹´í…Œê³ ë¦¬</div>
                <div>ë‚ ì§œ</div>
            </div>
            <div class="ranking-list" id="rankingList">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>ë­í‚¹ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Supabase ì„¤ì • -->
    <script src="../js/supabase-config.js"></script>

    <script>
        // ë¡œê·¸ì¸ ì²´í¬
        if (!isLoggedIn()) {
            window.location.href = 'login.html';
        }

        // ì‚¬ìš©ì ì •ë³´
        const user = getCurrentUser();

        // í˜„ì¬ í•„í„° ìƒíƒœ
        let currentCategory = 'all';
        let currentDifficulty = 'all';

        // DOM ìš”ì†Œ
        const rankingList = document.getElementById('rankingList');
        const myRecordCard = document.getElementById('myRecordCard');
        const myRecordGrid = document.getElementById('myRecordGrid');

        // ì¹´í…Œê³ ë¦¬ í•„í„° ì´ë²¤íŠ¸
        document.querySelectorAll('.filter-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.filter-tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                currentCategory = tab.dataset.category;
                loadRanking();
            });
        });

        // ë‚œì´ë„ í•„í„° ì´ë²¤íŠ¸
        document.querySelectorAll('.difficulty-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.difficulty-tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                currentDifficulty = tab.dataset.difficulty;
                loadRanking();
            });
        });

        // ì¹´í…Œê³ ë¦¬/ë‚œì´ë„ ë³€í™˜ ë§µ
        const categoryNameMap = {
            'concert': 'ì½˜ì„œíŠ¸', 'goods': 'êµ¿ì¦ˆ', 'restaurant': 'ì‹ë‹¹',
            'ì½˜ì„œíŠ¸': 'ì½˜ì„œíŠ¸', 'êµ¿ì¦ˆ': 'êµ¿ì¦ˆ', 'ì‹ë‹¹': 'ì‹ë‹¹'
        };
        const categoryClassMap = {
            'concert': 'concert', 'goods': 'goods', 'restaurant': 'restaurant',
            'ì½˜ì„œíŠ¸': 'concert', 'êµ¿ì¦ˆ': 'goods', 'ì‹ë‹¹': 'restaurant'
        };
        const difficultyNameMap = {
            'easy': 'ì‰¬ì›€', 'normal': 'ë³´í†µ', 'hard': 'ì–´ë ¤ì›€',
            'ì‰¬ì›€': 'ì‰¬ì›€', 'ë³´í†µ': 'ë³´í†µ', 'ì–´ë ¤ì›€': 'ì–´ë ¤ì›€'
        };
        const difficultyClassMap = {
            'easy': 'easy', 'normal': 'normal', 'hard': 'hard',
            'ì‰¬ì›€': 'easy', 'ë³´í†µ': 'normal', 'ì–´ë ¤ì›€': 'hard'
        };

        // ë­í‚¹ ë¡œë“œ
        async function loadRanking() {
            rankingList.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <p>ë­í‚¹ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                </div>
            `;

            try {
                let data;

                if (currentCategory === 'all' && currentDifficulty === 'all') {
                    // ì „ì²´ ê¸°ë¡ (ì¹´í…Œê³ ë¦¬/ë‚œì´ë„ í¬í•¨)
                    data = await getAllRecords(50);
                    renderAllRecords(data);
                } else {
                    // ì¹´í…Œê³ ë¦¬/ë‚œì´ë„ë³„ ë­í‚¹
                    if (currentCategory === 'all') {
                        // ëª¨ë“  ì¹´í…Œê³ ë¦¬ì—ì„œ í•´ë‹¹ ë‚œì´ë„
                        const categories = ['ì½˜ì„œíŠ¸', 'êµ¿ì¦ˆ', 'ì‹ë‹¹'];
                        const allData = [];
                        for (const cat of categories) {
                            const catData = await getRanking(cat, currentDifficulty, 20);
                            allData.push(...catData);
                        }
                        // ì‹œê°„ìˆœ ì •ë ¬
                        allData.sort((a, b) => a.elapsed_time - b.elapsed_time);
                        data = allData.slice(0, 50);
                    } else if (currentDifficulty === 'all') {
                        // í•´ë‹¹ ì¹´í…Œê³ ë¦¬ì˜ ëª¨ë“  ë‚œì´ë„
                        const difficulties = ['ì‰¬ì›€', 'ë³´í†µ', 'ì–´ë ¤ì›€'];
                        const allData = [];
                        for (const diff of difficulties) {
                            const diffData = await getRanking(currentCategory, diff, 20);
                            allData.push(...diffData);
                        }
                        allData.sort((a, b) => a.elapsed_time - b.elapsed_time);
                        data = allData.slice(0, 50);
                    } else {
                        data = await getRanking(currentCategory, currentDifficulty, 50);
                    }
                    renderCategoryRanking(data);
                }

                // ë‚´ ê¸°ë¡ ë¡œë“œ
                loadMyRecords();
            } catch (error) {
                console.error('ë­í‚¹ ë¡œë“œ ì˜¤ë¥˜:', error);
                rankingList.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">âŒ</div>
                        <p>ë­í‚¹ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤</p>
                    </div>
                `;
            }
        }

        // ì „ì²´ ê¸°ë¡ ë Œë”ë§ (ì¹´í…Œê³ ë¦¬/ë‚œì´ë„ í‘œì‹œ)
        function renderAllRecords(data) {
            if (!data || data.length === 0) {
                rankingList.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">ğŸ†</div>
                        <p>ì•„ì§ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.<br>ì²« ë²ˆì§¸ ê¸°ë¡ì˜ ì£¼ì¸ê³µì´ ë˜ì–´ë³´ì„¸ìš”!</p>
                    </div>
                `;
                return;
            }

            rankingList.innerHTML = data.map((item, index) => {
                const rank = index + 1;
                const isMe = item.nickname === user.nickname;
                const rankClass = rank === 1 ? 'gold' : rank === 2 ? 'silver' : rank === 3 ? 'bronze' : '';
                const date = new Date(item.created_at).toLocaleDateString('ko-KR');

                // ì¹´í…Œê³ ë¦¬ ë³€í™˜
                const catName = categoryNameMap[item.category] || item.category || '-';
                const catClass = categoryClassMap[item.category] || 'concert';

                // ë‚œì´ë„ ë³€í™˜
                const diffName = difficultyNameMap[item.difficulty] || item.difficulty || '-';
                const diffClass = difficultyClassMap[item.difficulty] || 'normal';

                return `
                    <div class="ranking-item ${isMe ? 'me' : ''}">
                        <div class="rank ${rankClass}">
                            ${rank <= 3 ? `<span class="rank-badge ${rankClass}">${rank === 1 ? 'ğŸ¥‡' : rank === 2 ? 'ğŸ¥ˆ' : 'ğŸ¥‰'}</span>` : rank}
                        </div>
                        <div class="player-info">
                            <div class="player-avatar">${item.nickname.charAt(0).toUpperCase()}</div>
                            <div class="player-name">${item.nickname} ${isMe ? '(ë‚˜)' : ''}</div>
                        </div>
                        <div class="time-value">${formatTimeSimple(item.elapsed_time)}</div>
                        <div>
                            <span class="category-badge ${catClass}">${catName}</span>
                            <span class="difficulty-badge ${diffClass}">${diffName}</span>
                        </div>
                        <div class="date-value">${date}</div>
                    </div>
                `;
            }).join('');
        }

        // ì¹´í…Œê³ ë¦¬ë³„ ë­í‚¹ ë Œë”ë§
        function renderCategoryRanking(data) {
            if (!data || data.length === 0) {
                rankingList.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">ğŸ†</div>
                        <p>ì•„ì§ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.<br>ì²« ë²ˆì§¸ ê¸°ë¡ì˜ ì£¼ì¸ê³µì´ ë˜ì–´ë³´ì„¸ìš”!</p>
                    </div>
                `;
                return;
            }

            rankingList.innerHTML = data.map((item, index) => {
                const rank = index + 1;
                const isMe = item.nickname === user.nickname;
                const rankClass = rank === 1 ? 'gold' : rank === 2 ? 'silver' : rank === 3 ? 'bronze' : '';
                const date = new Date(item.created_at).toLocaleDateString('ko-KR');

                // ì¹´í…Œê³ ë¦¬ ë³€í™˜
                const catName = categoryNameMap[item.category] || item.category || '-';
                const catClass = categoryClassMap[item.category] || 'concert';

                // ë‚œì´ë„ ë³€í™˜
                const diffName = difficultyNameMap[item.difficulty] || item.difficulty || '-';
                const diffClass = difficultyClassMap[item.difficulty] || 'normal';

                return `
                    <div class="ranking-item ${isMe ? 'me' : ''}">
                        <div class="rank ${rankClass}">
                            ${rank <= 3 ? `<span class="rank-badge ${rankClass}">${rank === 1 ? 'ğŸ¥‡' : rank === 2 ? 'ğŸ¥ˆ' : 'ğŸ¥‰'}</span>` : rank}
                        </div>
                        <div class="player-info">
                            <div class="player-avatar">${item.nickname.charAt(0).toUpperCase()}</div>
                            <div class="player-name">${item.nickname} ${isMe ? '(ë‚˜)' : ''}</div>
                        </div>
                        <div class="time-value">${formatTimeSimple(item.elapsed_time)}</div>
                        <div>
                            <span class="category-badge ${catClass}">${catName}</span>
                            <span class="difficulty-badge ${diffClass}">${diffName}</span>
                        </div>
                        <div class="date-value">${date}</div>
                    </div>
                `;
            }).join('');
        }

        // ë‚´ ê¸°ë¡ ë¡œë“œ
        async function loadMyRecords() {
            const records = await getMyBestRecords();

            if (records && records.length > 0) {
                myRecordCard.style.display = 'block';
                myRecordGrid.innerHTML = records.map(record => {
                    // ì´ë¯¸ í•œê¸€ì´ë©´ ê·¸ëŒ€ë¡œ, ì˜ì–´ë©´ ë³€í™˜
                    const categoryName = {
                        concert: 'ì½˜ì„œíŠ¸',
                        goods: 'êµ¿ì¦ˆ',
                        restaurant: 'ì‹ë‹¹',
                        'ì½˜ì„œíŠ¸': 'ì½˜ì„œíŠ¸',
                        'êµ¿ì¦ˆ': 'êµ¿ì¦ˆ',
                        'ì‹ë‹¹': 'ì‹ë‹¹'
                    }[record.category] || record.category;

                    const difficultyName = {
                        easy: 'ì‰¬ì›€',
                        normal: 'ë³´í†µ',
                        hard: 'ì–´ë ¤ì›€',
                        'ì‰¬ì›€': 'ì‰¬ì›€',
                        'ë³´í†µ': 'ë³´í†µ',
                        'ì–´ë ¤ì›€': 'ì–´ë ¤ì›€'
                    }[record.difficulty] || record.difficulty;

                    return `
                        <div class="my-record-item">
                            <div class="my-record-label">${categoryName} (${difficultyName})</div>
                            <div class="my-record-value">${formatTimeSimple(record.best_time)}</div>
                        </div>
                    `;
                }).join('');
            } else {
                myRecordCard.style.display = 'none';
            }
        }

        // ì´ˆê¸° ë¡œë“œ
        loadRanking();
    </script>
    <script>
        // Client-side search filtering
        document.addEventListener('DOMContentLoaded', () => {
            const searchInput = document.getElementById('searchInput');
            const rankingListContainer = document.getElementById('rankingList');

            if (searchInput) {
                searchInput.addEventListener('input', (e) => {
                    const searchTerm = e.target.value.toLowerCase();
                    
                    // Use a MutationObserver to ensure we filter items even after they are dynamically loaded
                    const observer = new MutationObserver(() => {
                        const rankingItems = rankingListContainer.querySelectorAll('.ranking-item');
                        rankingItems.forEach(item => {
                            const playerNameElement = item.querySelector('.player-name');
                            if (playerNameElement) {
                                const playerName = playerNameElement.textContent.toLowerCase();
                                if (playerName.includes(searchTerm)) {
                                    item.style.display = 'grid'; // Restore grid display
                                } else {
                                    item.style.display = 'none'; // Hide if no match
                                }
                            }
                        });
                    });

                    // Start observing the ranking list for changes
                    observer.observe(rankingListContainer, { childList: true, subtree: true });

                    // Also filter existing items immediately
                    const existingItems = rankingListContainer.querySelectorAll('.ranking-item');
                    existingItems.forEach(item => {
                        const playerNameElement = item.querySelector('.player-name');
                        if (playerNameElement) {
                            const playerName = playerNameElement.textContent.toLowerCase();
                            if (playerName.includes(searchTerm)) {
                                item.style.display = 'grid';
                            } else {
                                item.style.display = 'none';
                            }
                        }
                    });
                });
            }
        });
    </script>
</body>
</html>
