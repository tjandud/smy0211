<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ìºì¹˜í…Œì´ë¸” ë°°ë„ˆ í…ŒìŠ¤íŠ¸</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background: #f5f5f5;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
    }

    /* ë°°ë„ˆ ì»¨í…Œì´ë„ˆ */
    .banner-container {
      width: 100%;
      max-width: 480px;
      margin: 0 auto;
      background: #fff;
      position: relative;
      overflow: hidden; /* ì´ë¯¸ì§€ê°€ ë°•ìŠ¤ ë°–ìœ¼ë¡œ ë‚˜ê°€ë©´ ì˜ë¦¼ */
      box-shadow: 0 0 20px rgba(0,0,0,0.1);
    }

    /* ë°°ë„ˆ ì´ë¯¸ì§€ ì˜ì—­ */
    .banner-image-wrapper {
      width: 100%;
      height: 280px;
      position: relative;
      overflow: hidden; /* í•µì‹¬: ë°•ìŠ¤ ë°– ì´ë¯¸ì§€ ì˜ë¦¼ */
      background: #e0e0e0;
    }

    /* ìŠ¬ë¼ì´ë“œ ì»¨í…Œì´ë„ˆ */
    .slider-container {
      width: 100%;
      height: 100%;
      position: relative;
    }

    .slider-track {
      display: flex;
      width: 100%;
      height: 100%;
      transition: transform 0.5s ease-in-out;
    }

    .slide {
      min-width: 100%;
      height: 100%;
      position: relative;
    }

    .banner-image {
      width: 100%;
      height: 100%;
      object-fit: cover; /* ì´ë¯¸ì§€ ë¹„ìœ¨ ìœ ì§€í•˜ë©° ì±„ìš°ê¸° */
      object-position: center; /* ì¤‘ì•™ ì •ë ¬ */
    }





    /* ë’¤ë¡œê°€ê¸° ë²„íŠ¼ */
    .back-button {
      position: absolute;
      top: 16px;
      left: 16px;
      width: 40px;
      height: 40px;
      background: rgba(0,0,0,0.4);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 20;
      backdrop-filter: blur(4px);
    }

    .back-button:hover {
      background: rgba(0,0,0,0.6);
    }

    .back-button svg {
      width: 24px;
      height: 24px;
      stroke: #fff;
      stroke-width: 2.5;
    }

    /* ì°œí•˜ê¸° ë²„íŠ¼ */
    .favorite-button {
      position: absolute;
      top: 16px;
      right: 16px;
      width: 40px;
      height: 40px;
      background: rgba(0,0,0,0.4);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 20;
      backdrop-filter: blur(4px);
    }

    .favorite-button:hover {
      background: rgba(0,0,0,0.6);
    }

    .favorite-button svg {
      width: 22px;
      height: 22px;
      fill: none;
      stroke: #fff;
      stroke-width: 2;
    }

    .favorite-button.active svg {
      fill: #ff4444;
      stroke: #ff4444;
    }

    /* ì •ë³´ ì„¹ì…˜ */
    .info-section {
      padding: 20px;
      background: #fff;
    }

    .location-tags {
      margin-bottom: 8px;
    }

    .tag {
      display: inline-block;
      font-size: 12px;
      color: #666;
      background: #f5f5f5;
      padding: 4px 10px;
      border-radius: 12px;
    }

    .restaurant-title {
      font-size: 28px;
      font-weight: 700;
      margin: 8px 0 12px;
      color: #000;
    }

    .rating-section {
      display: flex;
      align-items: center;
      gap: 6px;
      margin-bottom: 10px;
    }

    .star {
      font-size: 16px;
    }

    .rating-score {
      font-size: 16px;
      font-weight: 700;
      color: #000;
    }

    .review-count {
      font-size: 14px;
      color: #666;
      cursor: pointer;
    }

    .restaurant-description {
      font-size: 12px; /* ì†Œê°œê¸€ í°íŠ¸ ì¶•ì†Œ */
      color: #666;
      line-height: 1.3;
      white-space: nowrap; /* í•œ ì¤„ë¡œ ê³ ì • */
      overflow: hidden;    /* ë„˜ì¹˜ëŠ” í…ìŠ¤íŠ¸ ìˆ¨ê¹€ */
      text-overflow: ellipsis; /* ê¸¸ë©´ ë§ì¤„ì„í‘œ ì²˜ë¦¬ */
      padding-bottom: 16px;
      border-bottom: 1px solid #f0f0f0;
    }

    /* ìƒì„¸ ì •ë³´ ì„¹ì…˜ */
    .details-section {
      padding: 16px 20px 20px;
      background: #fff;
      border-bottom: 8px solid #f5f5f5;
    }

    .detail-item {
      display: flex;
      align-items: center; /* ì•„ì´ì½˜ê³¼ í…ìŠ¤íŠ¸ ìˆ˜ì§ ê°€ìš´ë° ì •ë ¬ */
      gap: 8px;
      padding: 8px 0; /* ì•½ê°„ ì´˜ì´˜í•˜ê²Œ */
      font-size: 13px; /* ì „ì²´ í°íŠ¸ í¬ê¸° ì¶•ì†Œ */
      line-height: 1.2; /* ì•„ì´ì½˜ê³¼ ë†’ì´ë¥¼ ë§ì¶”ê¸° ìœ„í•œ ë¼ì¸ ë†’ì´ */
      color: #333;
    }

    .icon {
      width: 18px;
      height: 18px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }

    /* SVG ì•„ì´ì½˜ì´ í…ìŠ¤íŠ¸ì™€ ì •í™•íˆ ìˆ˜ì§ ê°€ìš´ë°ì— ì˜¤ë„ë¡ */
    .detail-item .icon svg {
      width: 18px;
      height: 18px;
      display: block;
    }

    .detail-text {
      flex: 1;
      font-size: 13px; /* í…ìŠ¤íŠ¸ í¬ê¸° ì¶•ì†Œ */
    }

    .map-link {
      color: #ff6b35;
      text-decoration: none;
      font-size: 13px;
    }

    .info-icon {
      width: 16px;
      height: 16px;
      border: 1px solid #ccc;
      border-radius: 50%;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
      color: #999;
    }

    .holiday-badge {
      background: #ffe5e5;
      color: #ff4444;
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 600;
    }

    /* ì˜ˆì•½ ë°°ì§€ */
    .booking-badges {
      padding: 16px 20px;
      background: #fff;
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      border-bottom: 8px solid #f5f5f5;
    }

    .badge {
      font-size: 12px;
      padding: 6px 12px;
      background: #f8f8f8;
      border: 1px solid #e0e0e0;
      border-radius: 16px;
      color: #333;
      white-space: nowrap;
    }

    /* íƒ­ ë©”ë‰´ */
    .tab-menu {
      display: flex;
      background: #fff;
      border-bottom: 1px solid #e0e0e0;
      padding: 0 20px;
      overflow: hidden;
    }

    .tab-item {
      flex-shrink: 0;
      padding: 14px 16px;
      background: none;
      border: none;
      border-bottom: 2px solid transparent;
      font-size: 14px;
      font-weight: 500;
      color: #999;
      cursor: pointer;
      white-space: nowrap;
    }

    .tab-item.active {
      color: #000;
      font-weight: 700;
      border-bottom-color: #000;
    }

    .tab-item .count {
      font-size: 12px;
      color: #999;
    }

    /* ì˜ˆì•½ ì•ˆë‚´ ì¹´ë“œ */
    .reservation-notice {
      margin: 16px 20px;
      padding: 16px;
      background: #f0f8ff;
      border-radius: 12px;
      display: flex;
      gap: 12px;
      align-items: flex-start;
    }

    .notice-icon {
      font-size: 20px;
    }

    .notice-content {
      flex: 1;
    }

    .notice-title {
      font-size: 13px;
      color: #0066cc;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .notice-text {
      font-size: 14px;
      color: #333;
      font-weight: 500;
    }

    /* ì˜ˆì•½/ì›¨ì´íŒ… ë²„íŠ¼ */
    .action-buttons {
      display: flex;
      gap: 10px;
      padding: 16px 20px 24px;
      background: #fff;
    }

    .action-btn {
      flex: 1;
      padding: 14px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      background: #fff;
      font-size: 16px;
      font-weight: 700;
      color: #999;
      cursor: pointer;
      transition: all 0.2s;
    }

    .action-btn.active {
      border-color: #ff6b35;
      background: #ff6b35;
      color: #fff;
    }

    .action-btn:hover {
      background: #f8f8f8;
    }

    .action-btn.active:hover {
      background: #ff5722;
    }

    /* í•˜ë‹¨ ê³ ì • ë°” */
    .bottom-bar {
      position: fixed;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 100%;
      max-width: 480px;
      background: #fff;
      border-top: 1px solid #e0e0e0;
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 16px;
      box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
      z-index: 1000;
    }

    /* í•˜ë‹¨ ë°” ë‚´ ë²„íŠ¼ ê¸°ë³¸ ë¸Œë¼ìš°ì € ìŠ¤íƒ€ì¼ ì œê±° */
    .bottom-bar button {
      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
    }

    .bottom-icon-btn {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: #fff;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      padding: 0;
      cursor: pointer;
      transition: all 0.2s;
      width: 44px;
      height: 44px;
      box-sizing: border-box;
    }

    .bottom-icon-btn svg {
      width: 22px;
      height: 22px;
      color: #666;
    }

    .bottom-icon-btn span { display: none; }

    .bottom-bar .bottom-main-btn {
      height: 44px;
      padding: 0 16px;
      background: #ff6a00;
      color: #fff;
      border: none;
      border-radius: 6px; /* ë„¤ëª¨ ë°•ìŠ¤ */
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      flex: 1 1 auto; /* ì˜¤ë¥¸ìª½ ì˜ì—­ì„ ê½‰ ì±„ì›€ */
      width: 100%;
      outline: none;
      cursor: pointer;
    }

    .bottom-bar .bottom-main-btn:hover { background: #e83317; }

    /* === ëª¨ë‹¬ ì˜¤ë²„ë ˆì´ & ì‹œíŠ¸ === */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.4);
      backdrop-filter: saturate(120%) blur(2px);
      opacity: 0;
      pointer-events: none;
      transition: opacity 220ms ease;
      z-index: 1500;
    }

    .modal-overlay.active { opacity: 1; pointer-events: auto; }

    .modal-sheet {
      position: fixed;
      left: 50%;
      transform: translateX(-50%);
      bottom: -100%;
      width: 100%;
      max-width: 480px;
      background: #fff;
      border-top-left-radius: 16px;
      border-top-right-radius: 16px;
      box-shadow: 0 -10px 30px rgba(0,0,0,0.2);
      transition: bottom 260ms cubic-bezier(0.25,0.8,0.25,1);
      z-index: 1600;
      padding-top: 6px; /* ìƒë‹¨ ì—¬ìœ  ê³µê°„ */
    }

    .modal-sheet.active { bottom: 0; }

    /* ìƒë‹¨ ë¶ˆí•„ìš” ìš”ì†Œ ì œê±°: í—¤ë”/ë‹«ê¸° ë²„íŠ¼ ë¯¸ì‚¬ìš© */

    /* ëª¨ë‹¬ ë³¸ë¬¸ ìŠ¤í¬ë¡¤ ì˜ì—­ */
    .modal-body {
      max-height: none; /* í•œëˆˆì— ë³´ì´ë„ë¡ ì œí•œ í•´ì œ */
      overflow-y: hidden; /* ì„¸ë¡œ ìŠ¤í¬ë¡¤ ì œê±° */
    }

    /* ìº˜ë¦°ë” í—¤ë” ìœ ì‚¬ */
    .calendar-header {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      padding: 12px 16px 8px; /* ì‚´ì§ ì—¬ìœ  ì¶”ê°€ */
    }

    .cal-today {
      color: #ff6a00;
      font-weight: 700;
      font-size: 14px;
    }

    .cal-arrow {
      color: #bbb;
      font-weight: 700;
      font-size: 18px;
      line-height: 1;
    }

    .calendar-month {
      font-size: 16px;
      font-weight: 700;
      color: #111;
    }

    .calendar-grid {
      padding: 2px 16px 8px; /* í•˜ë‹¨ ê°„ê²© ì¶•ì†Œ */
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 8px; /* ì¹¸ ê°„ê²© ì•½ê°„ ì¶•ì†Œ */
    }

    .day-cell {
      aspect-ratio: 1 / 1;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 999px; /* ë°•ìŠ¤í˜• ì œê±°, ë™ê·¸ë—ê²Œ */
      font-size: 14px;
      color: #333;
      background: #ffffff; /* í° ë² ì´ìŠ¤ */
    }

    .day-cell.today { color: #007aff; font-weight: 700; } /* ì˜¤ëŠ˜ íŒŒë€ ê¸€ì”¨ */
    .day-cell.selected {
      background: #ff3b2f;
      color: #fff;
      font-weight: 700;
    }

    /* ì¸ì› ì„ íƒ ì¹© */
    .people-chips {
      display: grid;
      grid-template-columns: repeat(9, 1fr);
      gap: 6px;
      padding: 8px 16px 8px; /* ìœ„ìª½ ì•½ê°„ ì—¬ìœ  */
      border-top: 1px solid rgba(0,0,0,0.06); /* ìº˜ë¦°ë”ì™€ ì¸ì›ìˆ˜ ì‚¬ì´ êµ¬ë¶„ì„  */
    }

    .chip {
      height: 34px;
      border-radius: 999px;
      border: 1px solid #e0e0e0;
      background: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      color: #333;
      cursor: pointer;
      font-size: 13px;
    }

    .chip.active { border-color: #ff6a00; color: #ff6a00; }

    /* ì‹œê°„ ì„ íƒ ì¹© */
    .time-chips {
      display: flex;
      gap: 8px;
      padding: 2px 16px 8px; /* í•˜ë‹¨ ê°„ê²© ì¶•ì†Œ */
      overflow-x: auto;
      overflow-y: hidden;
      -ms-overflow-style: none; /* IE/Edge */
      scrollbar-width: none; /* Firefox */
    }
    .time-chips::-webkit-scrollbar { display: none; } /* Chrome/Safari */

    .time-chip {
      flex: 0 0 auto;
      height: 36px;
      border-radius: 8px;
      background: #ff3b2f;
      color: #fff;
      padding: 0 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      cursor: pointer;
      font-size: 13px;
    }

    /* ëª¨ë‹¬ í•˜ë‹¨ ë‹«ê¸° ë²„íŠ¼ */
    .modal-footer {
      padding: 12px 20px 20px;
      border-top: 1px solid #f0f0f0;
    }

    .modal-footer .close-btn {
      width: 100%;
      height: 44px;
      border-radius: 8px;
      border: 1px solid #e0e0e0;
      background: #fff;
      font-weight: 700;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <!-- ì „ì—­ ë¯¸ì…˜+íƒ€ì´ë¨¸ íŒ¨ë„ (ìš°ìƒë‹¨ ê³ ì •) -->
  <div id="globalMissionPanel" style="position: fixed; top: 20px; right: 20px; background: white; border: 3px solid #ff6a00; border-radius: 12px; padding: 16px; box-shadow: 0 6px 14px rgba(2,6,23,0.25); z-index: 2000; min-width: 280px; display: none;">
    <div style="font-size: 16px; font-weight: 700; color: #1f2937; margin-bottom: 8px; display: flex; align-items: center; gap: 8px;">
      <span>ğŸ“‹ ë ˆìŠ¤í† ë‘ ë¯¸ì…˜</span>
      <span id="globalMissionBadge" style="display: inline-block; padding: 4px 10px; border-radius: 4px; font-size: 12px; font-weight: 700; background: #ff6a00; color: white;">LEVEL</span>
    </div>
    <div id="globalMissionText" style="font-size: 13px; color: #374151; margin-bottom: 8px; line-height: 1.6; padding: 10px; background: #f9fafb; border-radius: 6px;">ë¯¸ì…˜ì„ í™•ì¸í•˜ì„¸ìš”!</div>
    <div id="globalMissionList" style="font-size: 13px; color: #111827;"></div>
    <div style="margin-top:12px; display:flex; justify-content:flex-end;">
      <div style="background:#0b1220;color:#fff;border-radius:10px;padding:6px 10px;font-weight:900;min-width:64px;text-align:center;">
        <span id="globalMissionRemain">--:--</span>
      </div>
    </div>
  </div>
  
  <div class="banner-container">
    <!-- ë°°ë„ˆ ì´ë¯¸ì§€ ì˜ì—­ -->
    <div class="banner-image-wrapper">
      <!-- ìŠ¬ë¼ì´ë“œ ì»¨í…Œì´ë„ˆ -->
      <div class="slider-container">
        <div class="slider-track" id="sliderTrack"></div>
      </div>

    </div>

    <!-- ë’¤ë¡œê°€ê¸° ë²„íŠ¼ -->
    <div class="back-button" onclick="history.back()">
      <svg viewBox="0 0 24 24" fill="none">
        <path d="M15 18l-6-6 6-6" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </div>

    <!-- ì°œí•˜ê¸° ë²„íŠ¼ -->
    <div class="favorite-button" onclick="toggleFavorite(this)">
      <svg viewBox="0 0 24 24">
        <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </div>

    <!-- ë ˆìŠ¤í† ë‘ ê¸°ë³¸ ì •ë³´ -->
    <div class="info-section">
      <div class="location-tags">
        <span class="tag location-tag">ì„œìš¸ â€¢ ì¤‘ì‹</span>
      </div>
      <h1 class="restaurant-title shop-name">ë„ëŸ‰</h1>
      <div class="rating-section">
        <span class="star">â­</span>
        <span class="rating-score rating-text">4.9</span>
        <span class="review-count">ë¦¬ë·° 3,989ê°œ ></span>
      </div>
      <p class="restaurant-description shop-description">ë§›ìˆëŠ” í› ê¶ˆì™€ ì¤‘í™”ìš”ë¦¬ê°€ ìˆëŠ” ì‹ë‹¹</p>
    </div>

    <!-- ìƒì„¸ ì •ë³´ -->
    <div class="details-section">
      <div class="detail-item">
        <span class="icon">ğŸ“Œ</span>
        <span class="detail-text location-text">ê²½ë³µê¶ì—­ì—ì„œ 262m</span>
        <a href="#" class="map-link">ğŸ—ºï¸ ìœ„ì¹˜</a>
      </div>
      <div class="detail-item">
        <span class="icon">ğŸ•</span>
        <span class="detail-text price-info">ì ì‹¬ ì €ë… ë™ì¼ê°€ 4.9 ~ 11.9ë§Œì›</span>
        <span class="info-icon">â“˜</span>
      </div>
      <div class="detail-item">
        <span class="icon">ğŸ“…</span>
        <span class="detail-text opening-hours">ì˜¤ëŠ˜ (ìˆ˜) 12:00 ~ 22:00</span>
      </div>
    </div>

    <!-- ì˜ˆì•½ ì •ë³´ ë°°ì§€ -->
    <div class="booking-badges">
      <span class="badge">ğŸ”¥ ìµœëŒ€ 12ëª… ì˜ˆì•½</span>
      <span class="badge">ğŸ’³ ì˜ˆì•½ê¸ˆ 0ì›</span>
      <span class="badge extra-badge-1">ğŸ“„</span>
      <span class="badge extra-badge-2">ì£¼ì°¨</span>
      <span class="badge extra-badge-3">ë°˜ë ¤ë™ë¬¼</span>
    </div>
    
    <!-- ë©”ë‰´ í•˜ì´ë¼ì´íŠ¸ ì œê±°ë¨ -->

    <!-- íƒ­ ë©”ë‰´ -->
    <div class="tab-menu">
      <button class="tab-item active">í™ˆ</button>
      <button class="tab-item">ì†Œì‹</button>
      <button class="tab-item">ë©”ë‰´</button>
      <button class="tab-item">ì‚¬ì§„ <span class="count">5,197</span></button>
      <button class="tab-item">ë¦¬ë·° <span class="count">4,035</span></button>
      <button class="tab-item">ë°©ì†¡</button>
      <button class="tab-item">ë§¤ì¥ì •ë³´</button>
    </div>

    <!-- ì˜ˆì•½ ì•ˆë‚´ ì¹´ë“œ -->
    <div class="reservation-notice">
      <span class="notice-icon">ğŸ”Š</span>
      <div class="notice-content">
        <div class="notice-title">ì†Œì‹</div>
        <div class="notice-text notice-message">ì˜ˆì•½ ì•ˆë‚´</div>
      </div>
    </div>

    <!-- ì˜ˆì•½/ì›¨ì´íŒ… ë²„íŠ¼ -->
    <div class="action-buttons">
      <button class="action-btn reservation active">ì˜ˆì•½</button>
      <button class="action-btn waiting">ì›¨ì´íŒ…</button>
    </div>

    <!-- í•˜ë‹¨ ê³ ì • ë°” -->
    <div class="bottom-bar">
      <button class="bottom-icon-btn">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"/>
        </svg>
      </button>
      <button class="bottom-icon-btn">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/>
        </svg>
      </button>
      <button class="bottom-main-btn">ì˜ˆì•½í•˜ê¸°</button>
    </div>
  </div>

  <!-- ì˜ˆì•½ ëª¨ë‹¬: ìºì¹˜í…Œì´ë¸” ìœ ì‚¬ ë¹„ì£¼ì–¼ -->
  <div class="modal-overlay" id="reserveOverlay"></div>
  <div class="modal-sheet" id="reserveSheet" role="dialog" aria-modal="true">
    <div class="modal-body">
      <!-- ë¯¸ì…˜ í‘œì‹œ íŒ¨ë„ -->
      <div id="missionPanel" style="padding:10px 16px; border-bottom:1px solid #f0f0f0; display:none;">
        <div style="font-size:14px; font-weight:700; color:#111;">ë¯¸ì…˜</div>
        <div id="missionText" style="font-size:13px; color:#333; margin-top:4px;"></div>
        <div id="missionTimer" style="font-size:12px; color:#ff3b2f; margin-top:4px;">ë‚¨ì€ ì‹œê°„: <span id="missionRemain">--:--</span></div>
      </div>
      <div class="calendar-header">
        <span class="cal-today" id="calTodayText">ì˜¤ëŠ˜</span>
        <span class="cal-arrow">ã€ˆ</span>
        <span class="calendar-month" id="calendarMonth">2025ë…„ 12ì›”</span>
        <span class="cal-arrow">ã€‰</span>
      </div>
      <div class="calendar-grid" id="calendarGrid" aria-label="ë‚ ì§œ ì„ íƒ"></div>

      <div class="people-chips" aria-label="ì¸ì› ì„ íƒ">
        <div class="chip">1ëª…</div>
        <div class="chip active">2ëª…</div>
        <div class="chip">3ëª…</div>
        <div class="chip">4ëª…</div>
        <div class="chip">5ëª…</div>
        <div class="chip">6ëª…</div>
        <div class="chip">7ëª…</div>
        <div class="chip">8ëª…</div>
        <div class="chip">9ëª…</div>
      </div>

      <div class="time-chips" id="timeChips" aria-label="ì‹œê°„ ì„ íƒ"></div>

      <div class="modal-footer">
        <button class="close-btn" id="modalCloseBottom">ë‹«ê¸°</button>
      </div>
    </div>
  </div>

  <!-- ê²°ê³¼ ëª¨ë‹¬ (ì‹¤íŒ¨/ê²½ê³ /ê¸°ì¡´) -->
  <div id="resultOverlay" style="display:none;position:fixed;inset:0;background:rgba(2,6,23,0.45);z-index:3000;align-items:center;justify-content:center;padding:24px;">
    <div id="resultModal" style="width:400px;max-width:96%;background:#ffffff;border-radius:12px;padding:50px 40px;color:#111827;box-shadow:0 4px 20px rgba(0,0,0,0.3);text-align:center;">
      <!-- í†µì¼ëœ ì•„ì´ì½˜: ì› + ë°•ìŠ¤ + ë§ˆí¬ -->
      <div id="resultIcon" style="position:relative;width:88px;height:88px;margin:0 auto 24px;border-radius:50%;"></div>
      <h2 id="resultTitle" style="margin:0 0 40px 0;font-size:28px;text-align:center;font-weight:700;">ê²°ê³¼</h2>
      <p id="resultDesc" style="margin:0 0 40px 0;font-size:16px;line-height:1.5;text-align:center;color:#6b7280;"></p>
      <p id="elapsedTimeText" style="font-size: 18px; color: #666; margin: -20px 0 20px; display: none;">ì†Œìš”ì‹œê°„: <strong id="elapsedTime">00:00</strong></p>
      <div id="resultActions" style="display:flex;flex-direction:column;gap:10px;justify-content:center;">
        <button class="btn-action btn-save" id="saveRecordBtn" type="button" onclick="saveRecord()" style="display:none;background: linear-gradient(135deg, #fbbf24, #f97316); color: white; box-shadow: 0 0 20px rgba(251, 191, 36, 0.5); font-weight: 700; animation: pulse-save 1.5s infinite; width:100%; padding:14px; border-radius:6px; border:none; font-size:16px; font-weight:600; cursor:pointer;">ğŸ† ê¸°ë¡ ì €ì¥í•˜ê¸°</button>
        <button id="aiFeedbackBtn" type="button" onclick="goToAIFeedback()" style="display:none;width:100%;background:linear-gradient(135deg, #3b82f6, #06b6d4);color:#fff;border:0;padding:14px;border-radius:6px;font-weight:600;cursor:pointer;">ğŸ¤– AI í”¼ë“œë°± ë°›ê¸°</button>
        <button id="resultLevelBtn" type="button" style="width:100%;background:#00d9c8;color:#fff;border:0;padding:14px;border-radius:6px;font-weight:600;cursor:pointer;">ë‚œì´ë„ ì„ íƒìœ¼ë¡œ</button>
        <button id="resultRetryBtn" type="button" style="width:100%;background:#00d9c8;color:#fff;border:0;padding:14px;border-radius:6px;font-weight:600;cursor:pointer;">ë‹¤ì‹œí•˜ê¸°</button>
        <button id="resultHomeBtn" type="button" style="width:100%;background:#00d9c8;color:#fff;border:0;padding:14px;border-radius:6px;font-weight:600;cursor:pointer;">ë©”ì¸ìœ¼ë¡œ</button>
        <a href="../main-pages/ranking.html" class="btn-action" style="background: linear-gradient(135deg, #8b5cf6, #ec4899); color: white; text-decoration: none; display: inline-block; width:100%; padding:14px; border-radius:6px; font-size:16px; font-weight:600; text-align:center;">ğŸ‘‰ ìˆœìœ„í‘œ ë³´ëŸ¬ê°€ê¸°</a>
      </div>
      <p id="saveStatus" style="margin-top: 15px; font-size: 14px; color: #888;"></p>
      <style>
        @keyframes pulse-save {
          0%, 100% { transform: scale(1); box-shadow: 0 0 20px rgba(251, 191, 36, 0.5); }
          50% { transform: scale(1.03); box-shadow: 0 0 30px rgba(251, 191, 36, 0.8); }
        }
        .btn-save { animation: pulse-save 1.5s infinite; }
      </style>
    </div>
  </div>
  <!-- ì„±ê³µ ëª¨ë‹¬(ì½˜ì„œíŠ¸ ìŠ¤íƒ€ì¼) -->
  <div class="success-modal" id="successModal" style="display:none;">
    <div class="result-area-card" style="background:#fff; border-radius:16px; box-shadow:0 4px 24px rgba(0,0,0,0.12); padding:40px 32px; max-width:400px; margin:0 auto; text-align:center;">
      <div id="result-msg" style="font-size:22px; font-weight:700; color:#22c55e; margin-bottom:16px;">ë¯¸ì…˜ ì™„ë£Œ! êµ¬ë§¤ ì„±ê³µ!</div>
      <div style="font-size:15px; color:#888; margin-bottom:16px;">ì†Œìš”ì‹œê°„: <span style="font-weight:700;color:#222;" id="elapsedTime">00:00</span></div>
      <div style="display:flex;flex-direction:column;gap:12px;">
        <button class="btn-action btn-save" id="saveRecordBtn" onclick="saveRecord()" style="background: linear-gradient(135deg, #fbbf24, #f97316); color: white; font-weight: 700; animation: pulse-save 1.5s infinite; font-size:15px; padding:13px; border-radius:6px; border:none;">ğŸ† ê¸°ë¡ ì €ì¥í•˜ê¸°</button>
        <button class="btn-action" id="aiFeedbackBtn" onclick="goToAIFeedback()" style="background: linear-gradient(135deg, #3b82f6, #06b6d4); color: white; font-size:15px; padding:13px; border-radius:6px; border:none;">ğŸ¤– AI í”¼ë“œë°± ë°›ê¸°</button>
        <button class="btn-action btn-teal" onclick="location.href='restaurant-level.html'" style="font-size:15px; padding:13px; border-radius:6px; border:none; background:#00d9c8;color:#fff;">ë‚œì´ë„ ì„ íƒìœ¼ë¡œ</button>
        <button class="btn-action btn-teal" onclick="restartGame()" style="font-size:15px; padding:13px; border-radius:6px; border:none; background:#00d9c8;color:#fff;">ë‹¤ì‹œí•˜ê¸°</button>
        <button class="btn-action btn-teal" onclick="location.href='http://localhost:8080/a/index.html'" style="font-size:15px; padding:13px; border-radius:6px; border:none; background:#00d9c8;color:#fff;">ë©”ì¸ìœ¼ë¡œ</button>
        <a href="../main-pages/ranking.html" class="btn-action" style="background: linear-gradient(135deg, #8b5cf6, #ec4899); color: white; text-decoration: none; display: inline-block; font-size:15px; padding:13px; border-radius:6px;">ğŸ‘‰ ìˆœìœ„í‘œ ë³´ëŸ¬ê°€ê¸°</a>
      </div>
      <div style="margin-top:18px;font-size:13px;color:#ef4444;font-weight:600;">âš ï¸ ì§€ê¸ˆ ì €ì¥í•˜ì§€ ì•Šìœ¼ë©´ ê¸°ë¡ì´ ì €ì¥ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤!</div>
    </div>
    <style>
      @keyframes pulse-save {
        0%, 100% { transform: scale(1); box-shadow: 0 0 20px rgba(251, 191, 36, 0.5); }
        50% { transform: scale(1.03); box-shadow: 0 0 30px rgba(251, 191, 36, 0.8); }
      }
    </style>
  </div>

  <script>
    // ========== ì‹ë‹¹ ë°ì´í„° ==========
    const restaurantData = {
      easy: [
        {
          name: 'ì•„í‹°ìŠ¤íŠ¸ ë² ì´ì»¤ë¦¬',
          url: 'https://app.catchtable.co.kr/ct/shop/artistbakery?type=WAITING&currentSuggestionType=SHOP_NAME',
          image: 'image/restaurant/ì•„í‹°ìŠ¤íŠ¸ë² ì´ì»¤ë¦¬.png',
          rating: 4.5,
          location: 'ì•ˆêµ­ì—­',
          distance: '95m',
          maxPeople: 1,
          maxPeopleText: '1ì¸ë‹¹ 1ì¸ì› ë¯¸ë§Œ',
          deposit: 0,
          category: 'ì¹´í˜ â€¢ ë””ì €íŠ¸',
          priceRange: '1ì¸ë‹¹ 1ë§Œì› ë¯¸ë§Œ',
          hours: 'ì˜ì—… ì¤‘ 20:00 ì˜ì—… ë§ˆê°',
          badges: ['ì£¼ì°¨', 'ë°˜ë ¤ë™ë¬¼'],
          /* íŠ¹ë³„ ë©”ë‰´ ì œê±° */
        },
        {
          name: 'ì—…íˆ¬ë¯¸',
          url: 'https://app.catchtable.co.kr/ct/shop/uptome?type=DINING&currentSuggestionType=SHOP_NAME',
          image: 'image/restaurant/ì—…íˆ¬ë¯¸.png',
          rating: 4.8,
          location: 'í™ëŒ€ì…êµ¬ì—­',
          distance: '797m',
          maxPeople: 40,
          maxPeopleText: 'ìµœëŒ€ 40ì¸ ì˜ˆì•½',
          deposit: 0,
          paymentInfo: 'ì˜ˆì•½ê¸ˆ 0ì›',
          category: 'ì—°ë‚¨ â€¢ ì½”ìŠ¤ìš”ë¦¬',
          tags: ['ì½œë¼ì¼“', 'ê³µíœ´', 'í˜¸í…”ì¸ê·¼'],
          priceRange: 'ì ì‹¬ ì €ë… ë™ì¼ê°€ 4.9 ~ 11.9ë§Œì›',
          hours: 'ì˜¤ëŠ˜ (ìˆ˜) 12:00 ~ 22:00',
          additionalBadges: ['ìë™ê²°ì œ', 'ì£¼ì°¨', 'ê¸€ìê¸°'],
          badges: []
        },
        {
          name: 'ê¸ˆë¼ì§€ì‹ë‹¹',
          url: 'https://app.catchtable.co.kr/ct/shop/Goldpig?type=WAITING&foodKeywords=%EA%B8%88%EB%8F%BC%EC%A7%80&currentSuggestionType=SHOP_NAME',
          image: 'image/restaurant/ê¸ˆë¼ì§€ì‹ë‹¹.png',
          rating: 4.3,
          location: 'ì•½ìˆ˜ì—­',
          distance: '266m',
          maxPeople: 4,
          maxPeopleText: 'ìµœëŒ€ 4ëª… ì˜ˆì•½',
          deposit: 0,
          category: 'ì•½ìˆ˜ â€¢ ë¼ì§€ê³ ê¸°êµ¬ì´',
          priceRange: '1ì¸ë‹¹ 1-2ë§Œì›',
          hours: 'ì˜ì—… ì¤‘ 22:15 ë¼ìŠ¤íŠ¸ì˜¤ë”',
          badges: ['ì£¼ì°¨']
        }
      ],
      normal: [
        {
          name: 'í¬ë…¸ ë¶€ì˜¤ë…¸',
          url: 'https://app.catchtable.co.kr/ct/shop/ponobouno',
          image: 'image/restaurant/í¬ë…¸ë¶€ì˜¤ë…¸.png',
          rating: 4.6,
          location: 'ì••êµ¬ì •ë¡œë°ì˜¤ì—­',
          distance: '604m',
          maxPeople: 6,
          maxPeopleText: 'ìµœëŒ€ 6ëª… ì˜ˆì•½',
          deposit: 0,
          category: 'ë„ì‚°ê³µì› â€¢ ë‹¤ì´ë‹ë°”',
          priceRange: 'ì ì‹¬ ì˜ì—…ì•ˆí•¨ Â· ì €ë… 1-5ë§Œì›',
          hours: 'ì˜¤ëŠ˜ (ìˆ˜) Â· 18:00 ~ 24:00',
          badges: ['ë°œë ›', 'ì½œí‚¤ì§€', 'ì›ì»´'],
          description: 'COMFY, VIBEY, BEV! í‘ë°±ìš”ë¦¬ì‚¬ íˆë“ ì²œì¬ì˜ ì–‘ì‹ ë…¸í”„ PONO BUONO'
        },
        {
          name: 'ë„ëŸ‰',
          url: 'https://app.catchtable.co.kr/ct/shop/dolyang?type=DINING&currentSuggestionType=SHOP_NAME',
          image: 'image/restaurant/ë„ëŸ‰.png',
          rating: 4.9,
          location: 'ê²½ë³µê¶ì—­',
          distance: '262m',
          maxPeople: 12,
          maxPeopleText: 'ìµœëŒ€ 12ëª… ì˜ˆì•½',
          deposit: 0,
          paymentInfo: 'ì˜ˆì•½ê¸ˆ 0ì›',
          category: 'ì„œì´Œ â€¢ ì¤‘ì‹',
          priceRange: 'ì ì‹¬, ì €ë… ë™ì¼ê°€ Â· 1-7ë§Œì›',
          hours: 'ì˜¤ëŠ˜ (ìˆ˜) Â· 11:00 ~ 21:30',
          badges: ['ìë™ê²°ì œ', 'ì£¼ì°¨', 'ì½œí‚¤ì§€'],
          description: 'ë§›ìˆëŠ” í› ê¶ˆì™€ ì¤‘í™”ìš”ë¦¬ê°€ ìˆëŠ” ì‹ë‹¹'
        },
        {
          name: 'í‹°ì—”ë¯¸ë¯¸ í™ëŒ€',
          url: 'https://app.catchtable.co.kr/ct/shop/tianmimihongdae?type=WAITING&foodKeywords=%ED%8B%B0%EC%97%94%EB%AF%B8%EB%AF%B8&currentSuggestionType=SHOP_NAME',
          image: 'image/restaurant/í‹°ì—”ë¯¸ë¯¸.png',
          rating: 4.4,
          location: 'í™ëŒ€ì…êµ¬ì—­',
          distance: '199m',
          maxPeople: 8,
          maxPeopleText: 'ìµœëŒ€ 8ëª… ì˜ˆì•½',
          deposit: 0,
          category: 'í™ëŒ€ â€¢ ì¤‘ì‹',
          priceRange: 'í‹°ì—”ë¯¸ë¯¸ í•´ì‚°ë¬¼ëƒ‰ì±„ Â· 41,000ì›',
          hours: 'ì˜ì—… ì¤‘ Â· 20:00 ë¼ìŠ¤íŠ¸ì˜¤ë”',
          badges: ['ë¬´ì„ ì¸í„°ë„·', 'ëŒ€ê´€'],
          description: 'ë”¤ì„¬ì˜ ì—¬í–‰, ì¤‘ì‹ ì…°í”„ ì •ì§€ì„ ì˜ ë”¤ì„¬ & ê´‘ë‘¥ì‹ ìš”ë¦¬'
        }
      ],
      hard: [
        {
          name: 'ëª¨ìˆ˜ ì„œìš¸',
          url: 'https://app.catchtable.co.kr/ct/shop/tempmosuseoul?type=DINING&currentSuggestionType=SHOP_NAME',
          image: 'image/restaurant/ëª¨ìˆ˜ì„œìš¸.png',
          rating: 4.8,
          location: 'í•œê°•ì§„ì—­',
          distance: '518m',
          maxPeople: 8,
          deposit: 0,
          category: 'ê²½ë¦¬ë‹¨ê¸¸ â€¢ íŒŒì¸ë‹¤ì´ë‹',
          priceRange: 'ì ì‹¬ 32ë§Œì› Â· ì €ë… 42ë§Œì›',
          hours: 'ì˜¤ëŠ˜ (ìˆ˜) Â· ì ì‹¬ íœ´ë¬´ Â· 17:00 ~ 23:00',
          badges: ['ë…¸í‚¤ì¦ˆì¡´', 'ë¯¸ì·¨í•™ ì•„ë™ ì´ìš© ë¶ˆê°€'],
          description: 'Taste of Seoul'
        },
        {
          name: 'ë°ê¸€ìŠ¤',
          url: 'https://app.catchtable.co.kr/ct/shop/mingles?type=DINING&currentSuggestionType=SHOP_NAME',
          image: 'image/restaurant/ë°ê¸€ìŠ¤.png',
          rating: 4.8,
          location: 'ì••êµ¬ì •ë¡œë°ì˜¤ì—­',
          distance: '390m',
          maxPeople: 4,
          maxPeopleText: 'ìµœëŒ€ 4ëª… ì˜ˆì•½',
          deposit: 0,
          category: 'ì²­ë‹´ â€¢ í•œì‹',
          priceRange: 'ì ì‹¬ 30ë§Œì› Â· ì €ë… 40ë§Œì›',
          hours: 'ì˜¤ëŠ˜ (ìˆ˜) Â· 12:00 ~ 22:00',
          badges: ['ë°œë ›', 'ì½œí‚¤ì§€'],
          description: 'í•œì‹ì„ ê¸°ë³¸ìœ¼ë¡œ í•˜ëŠ” ê°•ë¯¼êµ¬ ì…°í”„ì˜ ê°ê°ì ì¸ íŒŒì¸ë‹¤ì´ë‹'
        }
      ]
    };

    // URLì—ì„œ ë‚œì´ë„ íŒŒë¼ë¯¸í„° ê°€ì ¸ì˜¤ê¸°
    function getDifficultyFromURL() {
      const urlParams = new URLSearchParams(window.location.search);
      // ê¸°ë³¸ê°’ì„ 'all'ë¡œ ì„¤ì •í•˜ì—¬ ëª¨ë“  ì‹ë‹¹ì—ì„œ ëœë¤ ì„ íƒë˜ë„ë¡ í•¨
      const lvl = (urlParams.get('level') || 'all').toLowerCase();
      return ['easy','normal','hard','all'].includes(lvl) ? lvl : 'all';
    }

    // URLì—ì„œ íŠ¹ì • ì‹ë‹¹ ê°•ì œ íŒŒë¼ë¯¸í„° ê°€ì ¸ì˜¤ê¸° (ì˜ˆ: ?shop=goldpig)
    function getShopFromURL() {
      const urlParams = new URLSearchParams(window.location.search);
      const shop = urlParams.get('shop');
      return shop ? shop.toLowerCase() : null;
    }
    function getLevelFromURL(){
      const urlParams = new URLSearchParams(window.location.search);
      return (urlParams.get('level')||'all').toLowerCase();
    }

    // ëœë¤ ì‹ë‹¹ ì„ íƒ (shop íŒŒë¼ë¯¸í„°ê°€ ìˆìœ¼ë©´ í•´ë‹¹ ì‹ë‹¹ ì‚¬ìš©)
    function getRandomRestaurant(difficulty) {
      const forcedShop = getShopFromURL();
      if (forcedShop) {
        const levels = Object.keys(restaurantData);
        const aliasMatch = (r) => {
          const key = r.name.replace(/\s+/g, '').toLowerCase();
          if (forcedShop === 'goldpig') return key.includes('ê¸ˆë¼ì§€');
          if (forcedShop === 'artistbakery' || forcedShop === 'artist') return key.includes('ì•„í‹°ìŠ¤íŠ¸');
          if (forcedShop === 'uptome') return key.includes('ì—…íˆ¬ë¯¸');
          return key.includes(forcedShop);
        };
        for (const level of levels) {
          const match = restaurantData[level].find(aliasMatch);
          if (match) return match;
        }
      }

      let pool = [];
      if (difficulty === 'all') {
        pool = [].concat(
          restaurantData.easy || [],
          restaurantData.normal || [],
          restaurantData.hard || []
        );
      } else {
        pool = restaurantData[difficulty] || restaurantData.easy;
      }
      const randomIndex = Math.floor(Math.random() * pool.length);
      return pool[randomIndex];
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹ë‹¹ ì •ë³´ í‘œì‹œ + ìŠ¬ë¼ì´ë“œ ì´ë¯¸ì§€ ë§¤í•‘
    function loadRestaurantData() {
      const difficulty = getDifficultyFromURL();
      const restaurant = getRandomRestaurant(difficulty);
      console.log('ë‚œì´ë„:', difficulty);
      console.log('ì„ íƒëœ ì‹ë‹¹:', restaurant);

      document.querySelector('.shop-name').textContent = restaurant.name;
      document.querySelector('.rating-text').textContent = restaurant.rating;
      document.querySelector('.location-text').textContent = `${restaurant.location}ì—ì„œ ${restaurant.distance}`;

      const firstBadge = document.querySelector('.booking-badges .badge:first-child');
      if (restaurant.maxPeopleText) {
        firstBadge.textContent = `ğŸ”¥ ${restaurant.maxPeopleText}`;
      } else {
        firstBadge.textContent = `ğŸ”¥ ìµœëŒ€ ${restaurant.maxPeople}ëª… ì˜ˆì•½`;
      }

      const secondBadge = document.querySelector('.booking-badges .badge:nth-child(2)');
      if (restaurant.paymentInfo) {
        secondBadge.textContent = `ğŸ’³ ${restaurant.paymentInfo}`;
      } else {
        secondBadge.textContent = `ğŸ’³ ì˜ˆì•½ê¸ˆ ${restaurant.deposit.toLocaleString()}ì›`;
      }

      const reserveBtn = document.querySelector('.bottom-main-btn');
      if (reserveBtn) {
        reserveBtn.style.background = '#ff6a00';
        reserveBtn.style.color = '#ffffff';
        reserveBtn.style.border = 'none';
        reserveBtn.style.borderRadius = '6px';
        reserveBtn.style.height = '44px';
        reserveBtn.style.lineHeight = '44px';
        reserveBtn.style.padding = '0 16px';
        reserveBtn.style.display = 'flex';
        reserveBtn.style.alignItems = 'center';
        reserveBtn.style.justifyContent = 'center';
        reserveBtn.style.flex = '1 1 auto';
        reserveBtn.style.width = '100%';
      }

      // ë°°ë„ˆ ì´ë¯¸ì§€ ì—…ë°ì´íŠ¸: shop ë³„ë¡œ ìŠ¬ë¼ì´ë“œ ì „ë¶€ ë§¤í•‘
      const aliasKey = (restaurant.name || '').replace(/\s+/g,'').toLowerCase();
      // ì´ë¯¸ì§€ íŒŒì¼ì€ 1~N ë²”ìœ„ë¡œ ì¡´ì¬. ì•„ë˜ ì¹´ìš´íŠ¸ë¥¼ ì‹¤ì œ í´ë”ì— ë§ì¶° í•˜ë“œì½”ë”©.
      const seriesCount = {
        'ì•„í‹°ìŠ¤íŠ¸': 4,
        'ê¸ˆë¼ì§€': 5,
        'ë„ëŸ‰': 11,
        'í¬ë…¸': 5,
        'í‹°ì—”ë¯¸ë¯¸': 7,
        'ëª¨ìˆ˜': 2,
        'ë°ê¸€ìŠ¤': 5,
        'ì—…íˆ¬ë¯¸': 5
      };
      function resolvePath(p){
        // í˜„ì¬ íŒŒì¼ì€ restaurant-pages/ í•˜ìœ„ì´ë¯€ë¡œ image/ ëŠ” ../image/ ë¡œ ì ‘ê·¼
        if(p.startsWith('image/')) return '../'+p;
        return p;
      }
      function pickSeries(base, count){
        // ì²« 3ì¥ë§Œ ìŠ¬ë¼ì´ë“œì— ì‚¬ìš©
        const c = Math.max(1, count||1);
        const arr = [];
        for(let i=1;i<=Math.min(3,c);i++){
          arr.push(resolvePath(`image/restaurant/${base}${i}.avif`));
        }
        return arr;
      }
      // ì´ë¦„ ë§¤í•‘: íŒŒì¼ ì ‘ë‘ì™€ ì—°ê²°
      let base = null;
      if(aliasKey.includes('ì•„í‹°ìŠ¤íŠ¸')) base = 'ì•„í‹°ìŠ¤íŠ¸';
      else if(aliasKey.includes('ê¸ˆë¼ì§€')) base = 'ê¸ˆë¼ì§€';
      else if(aliasKey.includes('ë„ëŸ‰')) base = 'ë„ëŸ‰';
      else if(aliasKey.includes('í¬ë…¸')) base = 'í¬ë…¸';
      else if(aliasKey.includes('í‹°ì—”ë¯¸ë¯¸')) base = 'í‹°ì—”ë¯¸ë¯¸';
      else if(aliasKey.includes('ëª¨ìˆ˜')) base = 'ëª¨ìˆ˜';
      else if(aliasKey.includes('ë°ê¸€ìŠ¤')) base = 'ë°ê¸€ìŠ¤';
      else if(aliasKey.includes('ì—…íˆ¬ë¯¸')) base = 'ì—…íˆ¬ë¯¸';
      const imgs = base ? pickSeries(base, seriesCount[base]) : [resolvePath(restaurant.image)];
      const track = document.getElementById('sliderTrack');
      track.innerHTML = '';
      imgs.forEach((src, idx)=>{
        const slide = document.createElement('div');
        slide.className = 'slide';
        const img = document.createElement('img');
        img.className = 'banner-image';
        img.alt = `ë ˆìŠ¤í† ë‘ ì´ë¯¸ì§€ ${idx+1}`;
        img.src = src;
        img.onerror = function(){ this.src = resolvePath(restaurant.image); };
        slide.appendChild(img);
        track.appendChild(slide);
      });
      totalSlides = imgs.length;
      currentSlide = 0;
      updateSlider();

      const noticeText = document.querySelector('.notice-message');
      if (noticeText) {
        noticeText.textContent = `${restaurant.name} ì˜ˆì•½ ì•ˆë‚´`;
      }

      const descriptions = {
        'ì•„í‹°ìŠ¤íŠ¸ ë² ì´ì»¤ë¦¬': 'ë°©ê¸ˆ ë‚˜ì˜¨ ì†Œê¸ˆë¹µê³¼ ë°”ê²ŒíŠ¸ ê·¸ë¦¬ê³  ë”°ëœ»í•œ ìˆ˜í”„ê°€ ê¸°ë‹¤ë¦¬ëŠ” ì•„í‹°ìŠ¤íŠ¸ ë² ì´ì»¤ë¦¬',
        'ì—…íˆ¬ë¯¸': 'í˜¸ì£¼ê¹Œì§€ ê°€ëŠ” ë¹„í–‰ê¸°í‘œë¥¼ ì ˆì•½í•´ì¤„ ì—…íˆ¬ë¯¸',
        'ê¸ˆë¼ì§€ì‹ë‹¹': '2024ë…„ ë¯¸ì‰ë¦° ê°€ì´ë“œ ì„ ì •, ì…€ëŸ½ë„ ì¤„ì„œëŠ” ë¼ì§€ê³ ê¸° í•« ìŠ¤íŒŸ',
        'í¬ë…¸ë¶€ì˜¤ë…¸': 'ì´íƒœì›ì˜ ì •í†µ ì´íƒˆë¦¬ì•ˆ íŒŒì¸ë‹¤ì´ë‹',
        'ë„ëŸ‰': 'ê²½ë³µê¶ ê·¼ì²˜ í”„ë¦¬ë¯¸ì—„ ì¤‘ì‹ë‹¹, í› ê¶ˆ ë§›ì§‘',
        'í‹°ì—”ë¯¸ë¯¸': 'í™ëŒ€ ë”¤ì„¬ ì „ë¬¸ì , ì¤‘ì‹ ìš”ë¦¬ì˜ ê¹Šì€ ë§›',
        'ëª¨ìˆ˜ ì„œìš¸': 'ë¯¸ìŠë­ 2ìŠ¤íƒ€, í•œêµ­ ìµœì •ìƒê¸‰ íŒŒì¸ë‹¤ì´ë‹',
        'ë°ê¸€ìŠ¤': 'ë¯¸ìŠë­ 2ìŠ¤íƒ€, ëª¨ë˜ í•œì‹ì˜ ëª…ê°€'
      };
      const descElement = document.querySelector('.shop-description');
      if (descElement && descriptions[restaurant.name]) {
        descElement.textContent = descriptions[restaurant.name];
      }

      const locationTag = document.querySelector('.location-tag');
      if (locationTag && restaurant.category) {
        locationTag.textContent = `ì„œìš¸ â€¢ ${restaurant.category}`;
      }

      const useSiteIcons = true;
      if (useSiteIcons) {
        const iconElems = document.querySelectorAll('.detail-item .icon');
        if (iconElems[0]) {
          iconElems[0].innerHTML = '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#555" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 1 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>';
        }
        if (iconElems[1]) {
          iconElems[1].innerHTML = '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#555" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="5" width="18" height="14" rx="2"/><path d="M7 12h10"/><path d="M7 9h3"/></svg>';
        }
        if (iconElems[2]) {
          iconElems[2].innerHTML = '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#555" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>';
        }
      }

      const priceInfo = document.querySelector('.price-info');
      if (priceInfo && restaurant.priceRange) {
        priceInfo.textContent = restaurant.priceRange;
      }

      const openingHours = document.querySelector('.opening-hours');
      if (openingHours && restaurant.hours) {
        openingHours.textContent = restaurant.hours;
      }

      const extraBadge1 = document.querySelector('.extra-badge-1');
      const extraBadge2 = document.querySelector('.extra-badge-2');
      const extraBadge3 = document.querySelector('.extra-badge-3');
      if (extraBadge1) extraBadge1.style.display = 'none';
      if (extraBadge2) extraBadge2.style.display = 'none';
      if (extraBadge3) extraBadge3.style.display = 'none';

      if (restaurant.badges && restaurant.badges.length > 0) {
        restaurant.badges.forEach((badge, index) => {
          if (index === 0 && extraBadge2) {
            extraBadge2.textContent = badge;
            extraBadge2.style.display = 'inline-block';
          } else if (index === 1 && extraBadge3) {
            extraBadge3.textContent = badge;
            extraBadge3.style.display = 'inline-block';
          }
        });
      }

      document.title = `${restaurant.name} - ìºì¹˜í…Œì´ë¸”`;
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
    window.addEventListener('DOMContentLoaded', function() {
      loadRestaurantData();
      // ì „ì—­ ë¯¸ì…˜/íƒ€ì´ë¨¸ ë³µêµ¬
      try{
        const raw = localStorage.getItem('ct_mission');
        const payload = raw ? JSON.parse(raw) : null;
        if(payload){
          renderGlobalMission(payload);
          startGlobalTimer(payload.endAt);
        }
      }catch(e){ console.warn('ë¯¸ì…˜ ë³µêµ¬ ì‹¤íŒ¨', e); }
    });

    function toggleFavorite(button) {
      button.classList.toggle('active');
    }

    // ========== ìŠ¬ë¼ì´ë“œ ê¸°ëŠ¥ ==========
    let currentSlide = 0;
    const sliderTrack = document.getElementById('sliderTrack');
    let totalSlides = 0;
    function updateSlider() { sliderTrack.style.transform = `translateX(-${currentSlide * 100}%)`; }
    function changeSlide(direction) {
      currentSlide += direction;
      if (currentSlide < 0) { currentSlide = totalSlides - 1; }
      else if (currentSlide >= totalSlides) { currentSlide = 0; }
      updateSlider();
      resetAutoPlay();
    }
    function goToSlide(index) { currentSlide = index; updateSlider(); resetAutoPlay(); }
    let autoPlayInterval;
    function startAutoPlay() { autoPlayInterval = setInterval(() => { changeSlide(1); }, 4000); }
    function resetAutoPlay() { clearInterval(autoPlayInterval); startAutoPlay(); }
    let touchStartX = 0; let touchEndX = 0;
    sliderTrack.addEventListener('touchstart', (e) => { touchStartX = e.changedTouches[0].screenX; });
    sliderTrack.addEventListener('touchend', (e) => { touchEndX = e.changedTouches[0].screenX; handleSwipe(); });
    function handleSwipe() { if (touchStartX - touchEndX > 50) { changeSlide(1); } else if (touchEndX - touchStartX > 50) { changeSlide(-1); } }
    startAutoPlay();

    // === ì˜ˆì•½ ëª¨ë‹¬ ë™ì‘ ===
    const overlay = document.getElementById('reserveOverlay');
    const sheet = document.getElementById('reserveSheet');
    const openBtn = document.querySelector('.bottom-main-btn');
    const closeBottom = document.getElementById('modalCloseBottom');
    const missionPanel = document.getElementById('missionPanel');
    const missionText = document.getElementById('missionText');
    const missionTimer = document.getElementById('missionTimer');
    const missionRemain = document.getElementById('missionRemain');
    let missionPayload = null;
    let missionTickId = null;
    const globalMissionPanel = document.getElementById('globalMissionPanel');
    const globalMissionBadge = document.getElementById('globalMissionBadge');
    const globalMissionText = document.getElementById('globalMissionText');
    const globalMissionList = document.getElementById('globalMissionList');
    const globalMissionRemain = document.getElementById('globalMissionRemain');
    let globalTimerAnimId = null;

    function openReserve() {
      overlay.classList.add('active');
      sheet.classList.add('active');
      document.body.style.overflow = 'hidden';
      try{
        const raw = localStorage.getItem('ct_mission');
        missionPayload = raw ? JSON.parse(raw) : null;
      }catch(e){ missionPayload=null; }
      if(missionPayload){
        missionPanel.style.display = 'block';
        renderMissionText(missionPayload.mission);
        startMissionTimer(missionPayload.endAt);
        renderGlobalMission(missionPayload);
        startGlobalTimer(missionPayload.endAt);
      } else {
        missionPanel.style.display = 'none';
      }
    }

    function closeReserve() {
      overlay.classList.remove('active');
      sheet.classList.remove('active');
      document.body.style.overflow = '';
    }

    openBtn.addEventListener('click', openReserve);
    overlay.addEventListener('click', closeReserve);
    closeBottom.addEventListener('click', closeReserve);
    // ì•Œë¦¼ ì‚¬ìš´ë“œ ë° í† ê¸€ ì œê±° ìš”ì²­ì— ë”°ë¼ ì¬ìƒ/ì»¨íŠ¸ë¡¤ ë¡œì§ ì œì™¸
    function renderMissionText(m){
      if(!m){ missionText.textContent = 'ë¯¸ì…˜ ì—†ìŒ'; return; }
      const lvl = getLevelFromURL();
      missionText.textContent = (lvl==='easy') ? 'ì–´ë–¤ ì¡°ê±´ì´ë“  ì˜ˆì•½ì„ ì„±ê³µì‹œì¼œë³´ì„¸ìš”!' : 'ë‹¤ìŒ ì¡°ê±´ì„ ë§Œì¡±í•´ì£¼ì„¸ìš”.';
      if(m.type==='any'){ return; }
      if(m.type==='one'){ const r = m.rules[0]; missionText.textContent += ' ' + formatRule(r); return; }
      if(m.type==='multi'){ const list = m.rules.map(formatRule).join(' Â· '); missionText.textContent += ' ' + list; return; }
      missionText.textContent = 'ë‹¤ìŒ ì¡°ê±´ì„ ë§Œì¡±í•´ì£¼ì„¸ìš”.';
    }
    function formatRule(rule){ if(rule.kind==='date') return `ë‚ ì§œ: ${rule.value}ì¼`; if(rule.kind==='people') return `ì¸ì›: ${rule.value}ëª…`; if(rule.kind==='time') return `ì‹œê°„: ${rule.value}`; return 'ì•Œ ìˆ˜ ì—†ëŠ” ì¡°ê±´'; }
    let missionCompleted = false;
    function startMissionTimer(endAt){
      function fmt(ms){ const r = Math.max(0, endAt - Date.now()); const s = Math.floor(r/1000); const mm = String(Math.floor(s/60)).padStart(2,'0'); const ss = String(s%60).padStart(2,'0'); return {text:`${mm}:${ss}`, remain:r}; }
      function tick(){ const {text, remain} = fmt(endAt); missionRemain.textContent = text; if(remain<=0){ cancelAnimationFrame(missionTickId); missionTickId=null; if(!missionCompleted){ showFail('ì‹œê°„ ì´ˆê³¼ë¡œ ì˜ˆì•½ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'); } } else { missionTickId = requestAnimationFrame(tick); } }
      if(missionTickId) cancelAnimationFrame(missionTickId); missionTickId = requestAnimationFrame(tick);
    }

    function renderGlobalMission(payload){
      if(!payload) return;
      const lvl = getLevelFromURL();
      globalMissionBadge.textContent = (lvl||'NORMAL').toUpperCase();
      globalMissionBadge.style.background = lvl==='easy' ? '#22c55e' : (lvl==='hard' ? '#ef4444' : '#2563EB');
      const m = payload.mission;
      globalMissionText.textContent = (lvl==='easy') ? 'ì–´ë–¤ ì¡°ê±´ì´ë“  ì˜ˆì•½ì„ ì„±ê³µì‹œì¼œë³´ì„¸ìš”!' : 'ë‹¤ìŒ ì¡°ê±´ì„ ë§Œì¡±í•´ì£¼ì„¸ìš”.';
      function checklistItem(rule, idx){
        return (
          '<div class="quest-item" id="global-quest-item-'+idx+'" style="display:flex;align-items:center;gap:8px;margin-bottom:8px;padding:8px;background:#f3f4f6;border-radius:6px;">'
          + '<div class="quest-checkbox" style="width:18px;height:18px;border:2px solid #9ca3af;border-radius:3px;display:flex;align-items:center;justify-content:center;font-size:12px;"></div>'
          + '<div>'+formatRule(rule)+'</div>'
          + '</div>'
        );
      }
      if(m.type==='any'){ globalMissionList.innerHTML = ''; }
      else if(m.type==='one'){ globalMissionList.innerHTML = checklistItem(m.rules[0], 0); }
      else { globalMissionList.innerHTML = m.rules.map((r,i)=>checklistItem(r,i)).join(''); }
      globalMissionPanel.style.display = 'block';
    }
    function updateGlobalChecklist(chosen){
      if(!missionPayload || !missionPayload.mission) return;
      const m = missionPayload.mission;
      function ok(rule){ if(rule.kind==='date') return chosen.date && chosen.date===rule.value; if(rule.kind==='people') return chosen.people && chosen.people===rule.value; if(rule.kind==='time') return chosen.time && chosen.time===rule.value; return false; }
      const rules = m.type==='any' ? [] : (m.type==='one' ? [m.rules[0]] : m.rules);
      rules.forEach((rule, idx)=>{
        const el = document.getElementById('global-quest-item-'+idx);
        if(!el) return;
        const box = el.querySelector('.quest-checkbox');
        const completed = ok(rule);
        el.style.background = completed ? '#d4edda' : '#f3f4f6';
        if(box){ box.style.background = completed ? '#22c55e' : 'transparent'; box.style.borderColor = completed ? '#22c55e' : '#9ca3af'; box.style.color = completed ? '#ffffff' : 'inherit'; box.textContent = completed ? 'âœ“' : ''; }
      });
    }
    function startGlobalTimer(endAt){
      if(!endAt){ return; }
      function frame(){ const r = Math.max(0, endAt - Date.now()); const s = Math.floor(r/1000); const mm = String(Math.floor(s/60)).padStart(2,'0'); const ss = String(s%60).padStart(2,'0'); globalMissionRemain.textContent = mm+':'+ss; if(r<=0){ cancelAnimationFrame(globalTimerAnimId); globalTimerAnimId=null; } else { globalTimerAnimId = requestAnimationFrame(frame); } }
      if(globalTimerAnimId) cancelAnimationFrame(globalTimerAnimId);
      globalTimerAnimId = requestAnimationFrame(frame);
    }

    function showWarning(msg){ showToast(msg || 'ë¯¸ì…˜ ì¡°ê±´ì„ ë§Œì¡±í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.'); }
    function showSuccess(){ openResultModal('ì„±ê³µ', 'ì˜ˆì•½ ì„±ê³µ! ë¯¸ì…˜ì„ ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤.', 'success'); try{ localStorage.removeItem('ct_mission'); }catch(e){} globalMissionPanel.style.display='none'; missionCompleted = true; if(missionTickId) { cancelAnimationFrame(missionTickId); missionTickId=null; } if(globalTimerAnimId) { cancelAnimationFrame(globalTimerAnimId); globalTimerAnimId=null; } closeReserve(); }
    function showFail(msg){ openResultModal('ì‹¤íŒ¨', msg || 'ì˜ˆì•½ ì‹¤íŒ¨', 'failure'); try{ localStorage.removeItem('ct_mission'); }catch(e){} globalMissionPanel.style.display='none'; missionCompleted = true; if(missionTickId) { cancelAnimationFrame(missionTickId); missionTickId=null; } if(globalTimerAnimId) { cancelAnimationFrame(globalTimerAnimId); globalTimerAnimId=null; } closeReserve(); }

    const resultOverlay = document.getElementById('resultOverlay');
    const resultTitle = document.getElementById('resultTitle');
    const resultDesc = document.getElementById('resultDesc');
    const resultRetryBtn = document.getElementById('resultRetryBtn');
    const resultLevelBtn = document.getElementById('resultLevelBtn');
    const resultHomeBtn = document.getElementById('resultHomeBtn');
    function openResultModal(title, desc, kind){
      resultTitle.textContent = title;
      resultDesc.textContent = desc;
      const icon = document.getElementById('resultIcon');
      if(kind==='success'){
        icon.style.background = '#22c55e';
        icon.innerHTML = '<div style="position:absolute;left:50%;top:50%;width:54px;height:54px;border-radius:10px;background:#1fbfa0;transform:translate(-50%,-50%);box-shadow:inset 0 0 0 2px rgba(255,255,255,0.22);"></div>'+
                          '<div style="position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:34px;height:34px;">'+
                            '<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" width="34" height="34">'+
                              '<path d="M20 7L9 18L4 13" fill="none" stroke="#ffffff" stroke-width="2.8" stroke-linecap="round" stroke-linejoin="round"/>'+
                            '</svg>'+
                          '</div>';
      } else if(kind==='failure'){
        icon.style.background = '#ef4444';
        icon.innerHTML = '<div style="position:absolute;left:50%;top:50%;width:54px;height:54px;border-radius:10px;background:#f25c5c;transform:translate(-50%,-50%);box-shadow:inset 0 0 0 2px rgba(255,255,255,0.18);"></div>'+
                          '<div style="position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:34px;height:34px;">'+
                            '<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" width="34" height="34">'+
                              '<path d="M15 9l-6 6M9 9l6 6" fill="none" stroke="#ffffff" stroke-width="2.8" stroke-linecap="round" stroke-linejoin="round"/>'+
                            '</svg>'+
                          '</div>';
      } else {
        icon.style.background = '#f59e0b';
        icon.innerHTML = '<div style="position:absolute;left:50%;top:50%;width:54px;height:54px;border-radius:10px;background:#f7b64a;transform:translate(-50%,-50%);box-shadow:inset 0 0 0 2px rgba(255,255,255,0.18);"></div>'+
                          '<div style="position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:34px;height:34px;">'+
                            '<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" width="34" height="34">'+
                              '<circle cx="12" cy="12" r="10" fill="none" stroke="#ffffff" stroke-width="2.6"/>'+
                              '<line x1="12" y1="8" x2="12" y2="12" stroke="#ffffff" stroke-width="2.6" stroke-linecap="round"/>'+
                              '<line x1="12" y1="16" x2="12" y2="16" stroke="#ffffff" stroke-width="2.6" stroke-linecap="round"/>'+
                            '</svg>'+
                          '</div>';
      }
      resultOverlay.style.display = 'flex';
    }
    resultRetryBtn.addEventListener('click', function(){ try{ localStorage.removeItem('ct_mission'); }catch(e){} const url = new URL(window.location.href); const level = url.searchParams.get('level') || 'normal'; window.location.href = '../restaurant-pages/restaurant-timer.html?level=' + encodeURIComponent(level); });
    resultLevelBtn.addEventListener('click', function(){ try{ localStorage.removeItem('ct_mission'); }catch(e){} window.location.href = 'restaurant-level.html'; });
    resultHomeBtn.addEventListener('click', function(){ try{ localStorage.removeItem('ct_mission'); }catch(e){} window.location.href = 'http://localhost:8080/a/index.html'; });
    resultOverlay.addEventListener('click', function(e){ if(e.target===resultOverlay){ resultOverlay.style.display = 'none'; } });

    // === ë¹„ë°©í•´í˜• ê²½ê³  í† ìŠ¤íŠ¸ UI ===
    (function(){
      var style = document.createElement('style');
      style.textContent = 
        '.toast-container{position:fixed;top:24px;left:50%;transform:translateX(-50%);z-index:3000;display:flex;flex-direction:column;gap:8px;pointer-events:none}'+
        '.toast{min-width:240px;max-width:90vw;background:rgba(17,24,39,0.92);color:#fff;border-radius:10px;padding:12px 16px;box-shadow:0 8px 20px rgba(0,0,0,0.25);font-size:14px;line-height:1.4;pointer-events:auto}'+
        '.toast-warning{background:rgba(217,119,6,0.95)}';
      document.head.appendChild(style);
      var container = document.createElement('div');
      container.className = 'toast-container';
      container.id = 'toastContainer';
      document.body.appendChild(container);
    })();

    function showToast(message){
      var container = document.getElementById('toastContainer');
      if(!container) return;
      var el = document.createElement('div');
      el.className = 'toast toast-warning';
      el.textContent = message;
      container.appendChild(el);
      setTimeout(function(){ el.style.transition = 'opacity 300ms, transform 300ms'; el.style.opacity = '0'; el.style.transform = 'translateY(-6px)'; setTimeout(function(){ if(el && el.parentNode){ el.parentNode.removeChild(el); } }, 320); }, 1600);
    }

    const calGrid = document.getElementById('calendarGrid');
    const calMonthLabel = document.getElementById('calendarMonth');
    const today = new Date();
    const year = today.getFullYear();
    const month = today.getMonth();
    const firstDay = new Date(year, month, 1);
    const startWeekday = firstDay.getDay();
    const daysInMonth = new Date(year, month + 1, 0).getDate();
    const monthLabel = `${year}ë…„ ${month + 1}ì›”`;
    calMonthLabel.textContent = monthLabel;
    const weekdayLabels = ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '];
    for (let w = 0; w < 7; w++) {
      const headerCell = document.createElement('div');
      headerCell.className = 'day-cell';
      headerCell.style.fontWeight = '600';
      headerCell.style.color = '#999';
      headerCell.textContent = weekdayLabels[w];
      calGrid.appendChild(headerCell);
    }
    for (let s = 0; s < startWeekday; s++) {
      const emptyCell = document.createElement('div');
      emptyCell.className = 'day-cell';
      emptyCell.style.visibility = 'hidden';
      calGrid.appendChild(emptyCell);
    }
    const todayDate = today.getDate();
    const tomorrowDate = todayDate + 1;
    for (let d = 1; d <= daysInMonth; d++) {
      const cell = document.createElement('div');
      cell.className = 'day-cell';
      cell.textContent = d;
      if (d === todayDate) { cell.classList.add('today'); }
      if (d === tomorrowDate) { cell.classList.add('selected'); }
      cell.addEventListener('click', () => {
        document.querySelectorAll('.day-cell.selected').forEach(el => el.classList.remove('selected'));
        cell.classList.add('selected');
        validateIfComplete();
      });
      calGrid.appendChild(cell);
    }
    const timeChips = document.getElementById('timeChips');
    function pushSlots(startH, startM, endH, endM) {
      const start = new Date(0,0,0,startH,startM);
      const end = new Date(0,0,0,endH,endM);
      const fmt = (h, m) => { const isPM = h >= 12; const hour12 = h % 12 === 0 ? 12 : h % 12; const mm = m.toString().padStart(2,'0'); return `ì˜¤${isPM ? 'í›„' : 'ì „'} ${hour12}:${mm}`; };
      for (let t = new Date(start); t <= end; t.setMinutes(t.getMinutes() + 30)) {
        const chip = document.createElement('div');
        chip.className = 'time-chip';
        chip.textContent = fmt(t.getHours(), t.getMinutes());
        chip.addEventListener('click', function(){ validateIfComplete(chip.textContent); });
        timeChips.appendChild(chip);
      }
    }
    pushSlots(11,30,13,30);
    pushSlots(17,30,20,0);
    timeChips.addEventListener('wheel', (e) => { if (Math.abs(e.deltaY) > Math.abs(e.deltaX)) { timeChips.scrollLeft += e.deltaY; e.preventDefault(); } }, { passive: false });
    let isDown = false; let startX = 0; let startScrollLeft = 0;
    function onMouseDown(e) { isDown = true; timeChips.classList.add('dragging'); startX = e.pageX - timeChips.offsetLeft; startScrollLeft = timeChips.scrollLeft; }
    function onMouseLeave() { isDown = false; timeChips.classList.remove('dragging'); }
    function onMouseUp() { isDown = false; timeChips.classList.remove('dragging'); }
    function onMouseMove(e) { if (!isDown) return; e.preventDefault(); const x = e.pageX - timeChips.offsetLeft; const walk = (x - startX); timeChips.scrollLeft = startScrollLeft - walk; }
    timeChips.addEventListener('mousedown', onMouseDown);
    timeChips.addEventListener('mouseleave', onMouseLeave);
    timeChips.addEventListener('mouseup', onMouseUp);
    timeChips.addEventListener('mousemove', onMouseMove);
    timeChips.addEventListener('touchmove', (e) => { if (e.cancelable) e.preventDefault(); }, { passive: false });

    const peopleChips = document.querySelectorAll('.people-chips .chip');
    peopleChips.forEach(function(chip){ chip.addEventListener('click', function(){ peopleChips.forEach(function(c){ c.classList.remove('active'); }); chip.classList.add('active'); validateIfComplete(); }); });

    function getSelectedDate(){ const sel = document.querySelector('.calendar-grid .day-cell.selected'); if(!sel) return null; return parseInt(sel.textContent,10); }
    function getSelectedPeople(){ const sel = document.querySelector('.people-chips .chip.active'); if(!sel) return null; return parseInt(sel.textContent.replace('ëª…',''),10); }
    function matchesMission(m, chosen){ if(!m) return true; if(m.type==='any') return true; function ok(rule){ if(rule.kind==='date') return chosen.date && chosen.date===rule.value; if(rule.kind==='people') return chosen.people && chosen.people===rule.value; if(rule.kind==='time') return chosen.time && chosen.time===rule.value; return false; } if(m.type==='one') return ok(m.rules[0]); if(m.type==='multi'){ var cnt=0; m.rules.forEach(function(r){ if(ok(r)) cnt++; }); return cnt >= (m.need||m.rules.length); } return false; }
    function validateIfComplete(timeText){ const dateVal = getSelectedDate(); const peopleVal = getSelectedPeople(); const chosen = { date: dateVal, people: peopleVal, time: timeText || null }; if(!missionPayload){ return; } const now = Date.now(); if(missionPayload.endAt && now > missionPayload.endAt){ showFail('ì‹œê°„ ì´ˆê³¼ë¡œ ì˜ˆì•½ ì‹¤íŒ¨'); return; } updateGlobalChecklist(chosen); if(timeText){ if(matchesMission(missionPayload.mission, chosen)){ showSuccess(); } else { showWarning('ë¯¸ì…˜ ì¡°ê±´ì— ë§ì§€ ì•ŠìŠµë‹ˆë‹¤.'); } } }
  </script>

<!-- Supabase ì„¤ì • -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="../js/supabase-config.js"></script>

<script>
// === ê¸°ë¡ ì €ì¥ ê¸°ëŠ¥ ===
let gameStartTime = Date.now();
let gameEndTime = null;
let elapsedMs = 0;
let recordSaved = false;

// í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹œì‘ ì‹œê°„ ê¸°ë¡
document.addEventListener('DOMContentLoaded', function() {
  gameStartTime = Date.now();
});

// ì„±ê³µ ëª¨ë‹¬ì´ í‘œì‹œë  ë•Œ ì†Œìš”ì‹œê°„ ê³„ì‚°
const resultOverlayEl = document.getElementById('resultOverlay');
const resultObserver = new MutationObserver(function(mutations) {
  mutations.forEach(function(mutation) {
    if (mutation.type === 'attributes' && mutation.attributeName === 'style') {
      if (resultOverlayEl.style.display === 'flex') {
        const resultTitle = document.getElementById('resultTitle').textContent;
        if (resultTitle === 'ì„±ê³µ') {
          gameEndTime = Date.now();
          elapsedMs = gameEndTime - gameStartTime;

          // ì†Œìš”ì‹œê°„ í‘œì‹œ
          const elapsedEl = document.getElementById('elapsedTime');
          const elapsedTextEl = document.getElementById('elapsedTimeText');
          if (elapsedEl && elapsedTextEl) {
            elapsedEl.textContent = formatTimeSimple(elapsedMs);
            elapsedTextEl.style.display = 'block';
          }

          // ì €ì¥ ë²„íŠ¼ ë° AI í”¼ë“œë°± ë²„íŠ¼ í‘œì‹œ
          const saveBtn = document.getElementById('saveRecordBtn');
          const aiFeedbackBtn = document.getElementById('aiFeedbackBtn');
          const saveStatus = document.getElementById('saveStatus');
          saveBtn.style.display = 'block';
          aiFeedbackBtn.style.display = 'block';

          if (!isLoggedIn()) {
            saveBtn.textContent = 'ğŸ”’ ë¡œê·¸ì¸ í•„ìš”';
            saveBtn.style.background = '#6b7280';
            saveStatus.innerHTML = '<a href="../main-pages/login.html" style="color: #8b5cf6;">ë¡œê·¸ì¸</a>í•˜ë©´ ê¸°ë¡ì„ ì €ì¥í•  ìˆ˜ ìˆì–´ìš”!';
          }
        }
      }
    }
  });
});

resultObserver.observe(resultOverlayEl, { attributes: true });

// ê¸°ë¡ ì €ì¥ í•¨ìˆ˜
async function saveRecord() {
  if (recordSaved) {
    alert('ì´ë¯¸ ì €ì¥ëœ ê¸°ë¡ì…ë‹ˆë‹¤!');
    return;
  }

  if (!isLoggedIn()) {
    if (confirm('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤. ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í• ê¹Œìš”?')) {
      window.location.href = '../main-pages/login.html';
    }
    return;
  }

  const saveBtn = document.getElementById('saveRecordBtn');
  const saveStatus = document.getElementById('saveStatus');

  saveBtn.disabled = true;
  saveBtn.textContent = 'ì €ì¥ ì¤‘...';

  try {
    const difficulty = getDifficulty();
    const recordId = await saveBookingRecord('restaurant', difficulty, elapsedMs, {
      type: 'restaurant',
      timestamp: new Date().toISOString()
    });

    if (recordId) {
      recordSaved = true;
      saveBtn.textContent = 'âœ… ì €ì¥ ì™„ë£Œ!';
      saveBtn.style.background = '#10b981';
      saveStatus.innerHTML = '<a href="../main-pages/ranking.html" style="color: #8b5cf6; font-weight: bold;">ğŸ‘‰ ìˆœìœ„í‘œ ë³´ëŸ¬ê°€ê¸°</a>';
    } else {
      throw new Error('ì €ì¥ ì‹¤íŒ¨');
    }
  } catch (error) {
    console.error('ê¸°ë¡ ì €ì¥ ì˜¤ë¥˜:', error);
    saveBtn.disabled = false;
    saveBtn.textContent = 'ğŸ† ê¸°ë¡ ì €ì¥í•˜ê¸°';
    saveStatus.textContent = 'ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
    saveStatus.style.color = '#ef4444';
  }
}

function getDifficulty() {
  return getLevelFromURL() || 'normal';
}

// === í´ë¦­ ì¶”ì  ë° AI í”¼ë“œë°± ê¸°ëŠ¥ ===
let clickCount = 0;
let mouseDistance = 0;
let lastMousePos = { x: 0, y: 0 };
let clickTimes = [];

// í´ë¦­ ì¶”ì 
document.addEventListener('click', function(e) {
  clickCount++;
  clickTimes.push(Date.now());
});

// ë§ˆìš°ìŠ¤ ì´ë™ ê±°ë¦¬ ì¶”ì 
document.addEventListener('mousemove', function(e) {
  if (lastMousePos.x !== 0 || lastMousePos.y !== 0) {
    const dx = e.clientX - lastMousePos.x;
    const dy = e.clientY - lastMousePos.y;
    mouseDistance += Math.sqrt(dx * dx + dy * dy);
  }
  lastMousePos = { x: e.clientX, y: e.clientY };
});

// AI í”¼ë“œë°± í˜ì´ì§€ë¡œ ì´ë™
function goToAIFeedback() {
  // í‰ê·  ë°˜ì‘ ì‹œê°„ ê³„ì‚°
  let avgReactionTime = 0;
  if (clickTimes.length > 1) {
    let totalGap = 0;
    for (let i = 1; i < clickTimes.length; i++) {
      totalGap += clickTimes[i] - clickTimes[i - 1];
    }
    avgReactionTime = Math.floor(totalGap / (clickTimes.length - 1));
  }

  // í”¼ë“œë°± ë°ì´í„° ì €ì¥
  const feedbackData = {
    category: 'restaurant',
    difficulty: getDifficulty(),
    elapsedTime: elapsedMs,
    clickCount: clickCount,
    success: true,
    mouseDistance: Math.floor(mouseDistance),
    accuracy: Math.min(100, Math.floor((5 / Math.max(1, clickCount)) * 100)),
    reactionTime: avgReactionTime
  };

  localStorage.setItem('ticketpro_feedback_data', JSON.stringify(feedbackData));
  localStorage.removeItem('ct_mission');
  location.href = '../main-pages/ai-feedback.html';
}
</script>

</body>
</html>
